/*!
 * HyperMD, copyright (c) by laobubu
 * Distributed under an MIT license: http://laobubu.net/HyperMD/LICENSE
 *
 * Break the Wall between writing and preview, in a Markdown Editor.
 *
 * HyperMD makes Markdown editor on web WYSIWYG, based on CodeMirror
 *
 * Homepage: http://laobubu.net/HyperMD/
 * Issues: https://github.com/laobubu/HyperMD/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("codemirror"),require("codemirror/addon/fold/foldcode"),require("codemirror/addon/fold/foldgutter"),require("codemirror/addon/fold/markdown-fold"),require("codemirror/addon/edit/closebrackets"),require("codemirror/lib/codemirror.css"),require("codemirror/addon/fold/foldgutter.css"),require("./theme/hypermd-light.css"),require("codemirror/mode/markdown/markdown"),require("./mode/hypermd.css"),require("codemirror/mode/meta")):"function"==typeof define&&define.amd?define(["exports","codemirror","codemirror/addon/fold/foldcode","codemirror/addon/fold/foldgutter","codemirror/addon/fold/markdown-fold","codemirror/addon/edit/closebrackets","codemirror/lib/codemirror.css","codemirror/addon/fold/foldgutter.css","./theme/hypermd-light.css","codemirror/mode/markdown/markdown","./mode/hypermd.css","codemirror/mode/meta"],t):t(e.HyperMD={},e.CodeMirror)}(this,function(e,B){"use strict";"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){var n=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),i=1;i<arguments.length;i++){var o=n[i];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(r[a]=o[a])}return r},writable:!0,configurable:!0});var s=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r="enabled"),this.on_cb=e,this.off_cb=t,this.state=n,this.subkey=r};function d(t,n,r){n=~~n||5;var i=250;setTimeout(function e(){if(n--){try{if(t())return}catch(e){}setTimeout(e,i),i*=2}else r&&r()},0)}function u(e,t){var n=null,r=0,i=function(){e(),n=0},o=function(){var e=+new Date;if(n){if(e<r)return;clearTimeout(n)}n=setTimeout(i,t),r=e+100};return o.stop=function(){n&&(clearTimeout(n),n=0)},o}s.prototype.ON=function(e){return this.on_cb=e,this},s.prototype.OFF=function(e){return this.off_cb=e,this},s.prototype.set=function(e,t){var n="object"==typeof e&&e?e[this.subkey]:e;t&&(n=!!n),n!==this.state&&((this.state=n)?this.on_cb&&this.on_cb(n):this.off_cb&&this.off_cb(n))},s.prototype.setBool=function(e){return this.set(e,!0)},s.prototype.bind=function(e,t,n){var r=this;return Object.defineProperty(e,t,{get:function(){return r.state},set:function(e){return r.set(e,n)},configurable:!0,enumerable:!0}),this};var t=B.addClass,n=B.rmClass,r=B.contains;function a(e,t){var n=new Array(t);if(n.fill)n.fill(e);else for(var r=0;r<t;r++)n[r]=e;return n}function $(e,t){for(var n="";0<t--;)n+=e;return n}function f(e,t){for(var n,r=[e];n=r.shift();)for(var i=0;i<n.length;i++){var o=n[i];o&&o.nodeType==Node.ELEMENT_NODE&&(t(o),o.children&&0<o.children.length&&r.push(o.children))}}function p(r,i,o){var e=r.getBoundingClientRect(),a=e.width,l=e.height,s=u(function(){var e=r.getBoundingClientRect(),t=e.width,n=e.height;a==t&&l==n||(i(t,n,a,l),a=t,l=n,setTimeout(s,200))},100),t=null;var n=!1;var c=[];return o||f([r],function(e){var t,n=e.tagName,r=getComputedStyle(e);"none"!=(t="resize",r.getPropertyValue(t)||"")&&(o=!0),/^(?:img|video)$/i.test(n)?(e.addEventListener("load",s,!1),e.addEventListener("error",s,!1)):/^(?:details|summary)$/i.test(n)&&e.addEventListener("click",s,!1)}),o&&(t=setTimeout(function e(){t&&clearTimeout(t),n||(t=setTimeout(e,200)),s()},200)),{check:s,stop:function(){n=!0,s.stop(),t&&(clearTimeout(t),t=null);for(var e=0;e<c.length;e++)c[e][0].removeEventListener(c[e][1],s,!1)}}}var o="__hypermd__",l={lineNumbers:!0,lineWrapping:!0,theme:"hypermd-light",mode:"text/x-hypermd",tabSize:4,autoCloseBrackets:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","HyperMD-goback"]},c={theme:"default"};function i(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,r=0;r<n.length;r++)if((t-=n[r].size)<0)return r}function w(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[i(e,t)];var n=e.display.externalMeasured;return n&&t>=n.lineN&&t<n.lineN+n.size?n:void 0}function T(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache,before:!1};for(var r=0;r<e.rest.length;r++)if(e.rest[r]==t)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!1};for(var i=0;i<e.rest.length;i++)if(e.rest[i].lineNo()>n)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}var h=Object.freeze({findViewIndex:i,findViewForLine:w,mapFromLineView:T}),z=function(e){this.cm=e};function x(e,t,n){var r,i=t.line,o={line:i,ch:0},a={line:i,ch:t.ch},l="function"==typeof n&&n,s=!l&&new RegExp("(?:^|\\s)"+n+"(?:\\s|$)"),c=e.getLineTokens(i);for(r=0;r<c.length&&!(c[r].end>=t.ch);r++);if(r===c.length)return null;for(var d=r;d<c.length;d++){var h=c[d];if(l?!l(h):!s.test(h.type))break;a.ch=h.end}for(d=r;0<=d;d--){h=c[d];if(!(l?l(h):s.test(h.type))){o.ch=h.end;break}}return{from:o,to:a}}function m(e,t){if(!t)for(var n=0,r=e.display.view;n<r.length;n+=1){var i=r[n];i.measure&&(i.measure.cache={})}setTimeout(function(){e.display.input.showSelection(e.display.input.prepareSelection())},60)}z.prototype.findNext=function(n,e,r){var i=this.lineNo,o=this.lineTokens,a=null,l=this.i_token+1,t=!1;if(!0===e?t=!0:"number"==typeof e&&(l=e),r)if(r.line>i)l=o.length;else if(r.line<i);else for(;l<o.length&&!(o[l].start>=r.ch);l++);for(;l<o.length;l++){var s=o[l];if("function"==typeof n?n(s):n.test(s.type)){a=s;break}}if(!a&&t){var c=this.cm,d=Math.max(r?r.line:0,i+1);c.eachLine(d,c.lastLine()+1,function(e){if(i=e.lineNo(),o=c.getLineTokens(i),l=0,r&&i===r.line)for(;l<o.length&&!(o[l].start>=r.ch);l++);for(;l<o.length;l++){var t=o[l];if("function"==typeof n?n(t):n.test(t.type))return a=t,!0}})}return a?{lineNo:i,token:a,i_token:l}:null},z.prototype.findPrev=function(e,t,n){var r=this.lineNo,i=this.lineTokens,o=null,a=this.i_token-1,l=!1;if(!0===t?l=!0:"number"==typeof t&&(a=t),n)if(n.line<r)a=-1;else if(n.line>r);else for(;a<i.length&&!(i[a].start>=n.ch);a++);for(a>=i.length&&(a=i.length-1);0<=a;a--){var s=i[a];if("function"==typeof e?e(s):e.test(s.type)){o=s;break}}if(!o&&l){var c=this.cm,d=Math.min(n?n.line:c.lastLine(),r-1),h=c.firstLine();for(r=d+1;!o&&h<=--r;){c.getLineHandle(r);if(i=c.getLineTokens(r),a=0,n&&r===n.line)for(;a<i.length&&!(i[a].start>=n.ch);a++);for(a>=i.length&&(a=i.length-1);0<=a;a--){s=i[a];if("function"==typeof e?e(s):e.test(s.type)){o=s;break}}}}return o?{lineNo:r,token:o,i_token:a}:null},z.prototype.expandRange=function(t,e){var n,r=this.cm;"function"==typeof t?n=t:("string"==typeof t&&(t=new RegExp("(?:^|\\s)"+t+"(?:\\s|$)")),n=function(e){return!!e&&t.test(e.type||"")});for(var i={lineNo:this.lineNo,i_token:this.i_token,token:this.lineTokens[this.i_token]},o=Object.assign({},i),a=!1,l=this.lineTokens,s=this.i_token;!a;){for(s>=l.length&&(s=l.length-1);0<=s;s--){var c=l[s];if(!n(c)){a=!0;break}i.i_token=s,i.token=c}if(a||!(e&&i.lineNo>r.firstLine()))break;s=(l=r.getLineTokens(--i.lineNo)).length-1}for(a=!1,l=this.lineTokens,s=this.i_token;!a;){for(s<0&&(s=0);s<l.length;s++){var d=l[s];if(!n(d)){a=!0;break}o.i_token=s,o.token=d}if(a||!(e&&o.lineNo<r.lastLine()))break;l=r.getLineTokens(++o.lineNo),s=0}return{from:i,to:o}},z.prototype.setPos=function(e,t,n){void 0===t?(t=e,e=this.line):"number"==typeof e&&(e=this.cm.getLineHandle(e));var r=e===this.line,i=0;n||!r?(this.line=e,this.lineNo=e.lineNo(),this.lineTokens=this.cm.getLineTokens(this.lineNo)):(i=this.i_token,this.lineTokens[i].start>t&&(i=0));for(var o=this.lineTokens;i<o.length&&!(o[i].end>t);i++);this.i_token=i},z.prototype.getToken=function(e){return"number"!=typeof e&&(e=this.i_token),this.lineTokens[e]},z.prototype.getTokenType=function(e){"number"!=typeof e&&(e=this.i_token);var t=this.lineTokens[e];return t&&t.type||""};function g(r,i,o){return function(e){if(e.hmd||(e.hmd={}),!e.hmd[r]){var t=new i(e);if(e.hmd[r]=t,o)for(var n in o)t[n]=o[n];return t}return e.hmd[r]}}var v=Object.freeze({Addon:function(e){},Getter:g}),U=/[^\\][$|]/,W=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,X=/^((?:(?:aaas?|about|acap|adiumxtra|af[ps]|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|cap|chrome(?:-extension)?|cid|coap|com-eventbrite-attendee|content|crid|cvs|data|dav|dict|dlna-(?:playcontainer|playsingle)|dns|doi|dtn|dvb|ed2k|facetime|feed|file|finger|fish|ftp|geo|gg|git|gizmoproject|go|gopher|gtalk|h323|hcp|https?|iax|icap|icon|im|imap|info|ipn|ipp|irc[6s]?|iris(?:\.beep|\.lwz|\.xpc|\.xpcs)?|itms|jar|javascript|jms|keyparc|lastfm|ldaps?|magnet|mailto|maps|market|message|mid|mms|ms-help|msnim|msrps?|mtqp|mumble|mupdate|mvn|news|nfs|nih?|nntp|notes|oid|opaquelocktoken|palm|paparazzi|platform|pop|pres|proxy|psyc|query|res(?:ource)?|rmi|rsync|rtmp|rtsp|secondlife|service|session|sftp|sgn|shttp|sieve|sips?|skype|sm[bs]|snmp|soap\.beeps?|soldat|spotify|ssh|steam|svn|tag|teamspeak|tel(?:net)?|tftp|things|thismessage|tip|tn3270|tv|udp|unreal|urn|ut2004|vemmi|ventrilo|view-source|webcal|wss?|wtai|wyciwyg|xcon(?:-userid)?|xfire|xmlrpc\.beeps?|xmpp|xri|ymsgr|z39\.50[rs]?):(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]|\([^\s()<>]*\))+(?:\([^\s()<>]*\)|[^\s`*!()\[\]{};:'".,<>?Â«Â»â€œâ€â€˜â€™]))/i,Y=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,G=/^\.{0,2}\/[^\>\s]+/,V=/^(?:[-()/a-zA-Z0-9ã‚¡-ãƒºãƒ¼-ãƒ¾ï½¦-ï¾Ÿï½°ï¼-ï¼™ï¼¡-ï¼ºï½-ï½šã-ã‚–ã‚™-ã‚ãƒ¼ã€…ã-ã‚“ã‚¡-ãƒ¾ä¸€-\u9FEFã€-ä¶µï¨ï¨ï¨‘ï¨“ï¨”ï¨Ÿï¨¡ï¨£ï¨¤ï¨§-ï¨©]|[\ud840-\ud868][\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|[\ud86a-\ud86c][\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d])+/,Z=/^\s*[^\|].*?\|.*[^|]\s*$/,Q=/^\s*[^\|].*\|/,J=/^\s*\|[^\|]+\|.+\|\s*$/,ee=/^\s*\|/,te={};function ne(e){e.hmdTable=0,e.hmdTableColumns=[],e.hmdTableID=null,e.hmdTableCol=e.hmdTableRow=0}te[1]="hmd-barelink",te[6]="hmd-barelink2",te[2]="hmd-barelink hmd-footref",te[4]="hmd-footnote line-HyperMD-footnote",te[7]="hmd-footref2";var re=/^\s+((\d+[).]|[-*+])\s+)?/,b={hr:"line-HyperMD-hr line-background-HyperMD-hr-bg hr",list1:"list-1",list2:"list-2",list3:"list-3",code:"inline-code",hashtag:"hashtag meta"};B.defineMode("hypermd",function(I,e){var F={front_matter:!0,math:!0,table:!0,toc:!0,orgModeMarkup:!0,hashtag:!1,fencedCodeBlockHighlighting:!0,name:"markdown",highlightFormatting:!0,taskLists:!0,strikethrough:!0,emoji:!0,tokenTypeOverrides:b};Object.assign(F,e),F.tokenTypeOverrides!==b&&(F.tokenTypeOverrides=Object.assign({},b,F.tokenTypeOverrides)),F.name="markdown";var P={htmlBlock:null},q=B.getMode(I,F),t=Object.assign({},q);function o(e,t){var n=t.hmdInnerExitChecker(e,t),r=t.hmdInnerStyle,i=(!n||!n.skipInnerMode)&&t.hmdInnerMode.token(e,t.hmdInnerState)||"";return r&&(i+=" "+r),n&&(n.style&&(i+=" "+n.style),n.endPos&&(e.pos=n.endPos),t.hmdInnerExitChecker=null,t.hmdInnerMode=null,t.hmdInnerState=null,t.hmdOverride=null),i.trim()||null}function $(n){return{token:function(e){var t=e.string.indexOf(n,e.start);return-1===t?e.skipToEnd():0===t?e.pos+=n.length:(e.pos=t,"\\"===e.string.charAt(t-1)&&e.pos++),null}}}function z(n,r){return r||(r={}),function(e,t){return e.string.substr(e.start,n.length)===n?(r.endPos=e.start+n.length,r):null}}function K(e,t,n,r){if("string"==typeof n&&(n=B.getMode(I,n)),!(n&&"null"!==n.name||(n="endTag"in r?$(r.endTag):"function"==typeof r.fallbackMode&&r.fallbackMode())))throw new Error("no mode");t.hmdInnerExitChecker="endTag"in r?z(r.endTag):r.exitChecker,t.hmdInnerStyle=r.style,t.hmdInnerMode=n,t.hmdOverride=o,t.hmdInnerState=B.startState(n);var i=r.style||"";return r.skipFirstToken||(i+=" "+n.token(e,t.hmdInnerState)),i.trim()}return t.startState=function(){var e=q.startState();return ne(e),e.hmdOverride=null,e.hmdInnerExitChecker=null,e.hmdInnerMode=null,e.hmdLinkType=0,e.hmdNextMaybe=F.front_matter?1:0,e.hmdNextState=null,e.hmdNextStyle=null,e.hmdNextPos=null,e.hmdHashtag=0,e},t.copyState=function(e){for(var t=q.copyState(e),n=0,r=["hmdLinkType","hmdNextMaybe","hmdTable","hmdTableID","hmdTableCol","hmdTableRow","hmdOverride","hmdInnerMode","hmdInnerStyle","hmdInnerExitChecker","hmdNextPos","hmdNextState","hmdNextStyle","hmdHashtag"];n<r.length;n+=1){var i=r[n];t[i]=e[i]}return t.hmdTableColumns=e.hmdTableColumns.slice(0),e.hmdInnerMode&&(t.hmdInnerState=B.copyState(e.hmdInnerMode,e.hmdInnerState)),t},t.blankLine=function(e){var t,n=e.hmdInnerMode;return n?n.blankLine&&(t=n.blankLine(e.hmdInnerState)):t=q.blankLine(e),t||(t=""),-1===e.code&&(t+=" line-HyperMD-codeblock line-background-HyperMD-codeblock-bg"),ne(e),t.trim()||null},t.indent=function(e,t){var n=e.hmdInnerMode||q,r=n.indent;return"function"==typeof r?r.apply(n,arguments):B.Pass},t.innerMode=function(e){return e.hmdInnerMode?{mode:e.hmdInnerMode,state:e.hmdInnerState}:q.innerMode(e)},t.token=function(e,t){if(t.hmdOverride)return t.hmdOverride(e,t);if(1===t.hmdNextMaybe){if("---"===e.string)return t.hmdNextMaybe=2,K(e,t,"yaml",{style:"hmd-frontmatter",fallbackMode:function(){return $("---")},exitChecker:function(e,t){return"---"===e.string?(t.hmdNextMaybe=0,{endPos:3}):null}});t.hmdNextMaybe=0}var n,r=t.f===P.htmlBlock,i=-1===t.code,o=0===e.start,a=t.linkText,l=t.linkHref,s=!(i||r),c=s&&!(t.code||t.indentedCode||t.linkHref),d="";if(s){if(F.math&&c&&(n=e.match(/^\${1,2}/,!1))){var h=n[0],u=h.length;if(2===u||e.string.slice(e.pos).match(/[^\\]\$/)){var m=B.getMode(I,{name:"stex"}),f="stex"!==m.name;return d+=K(e,t,m,{style:"math",skipFirstToken:f,fallbackMode:function(){return $(h)},exitChecker:z(h,{style:"formatting formatting-math formatting-math-end math-"+u})}),f&&(e.pos+=n[0].length),d+=" formatting formatting-math formatting-math-begin math-"+u}}if(o&&F.orgModeMarkup&&(n=e.match(/^\#\+(\w+\:?)\s*/)))return e.eol()||(t.hmdOverride=function(e,t){return e.skipToEnd(),t.hmdOverride=null,"string hmd-orgmode-markup"}),"meta formatting-hmd-orgmode-markup hmd-orgmode-markup line-HyperMD-orgmode-markup";if(o&&F.toc&&e.match(/^\[TOCM?\]\s*$/i))return"meta line-HyperMD-toc hmd-toc";if(c&&!t.hmdLinkType&&(e.match(X)||e.match(Y)))return"url"}t.hmdNextState?(e.pos=t.hmdNextPos,d+=" "+(t.hmdNextStyle||""),Object.assign(t,t.hmdNextState),t.hmdNextState=null,t.hmdNextStyle=null,t.hmdNextPos=null):d+=" "+(q.token(e,t)||""),0!==t.hmdHashtag&&(d+=" "+F.tokenTypeOverrides.hashtag),!P.htmlBlock&&t.htmlState&&(P.htmlBlock=t.f);var p=t.f===P.htmlBlock,g=-1===t.code;s=s&&!(p||g),(c=c&&s&&!(t.code||t.indentedCode||t.linkHref))&&(n=e.current().match(U))&&(e.pos=e.start+n.index+1);var v=e.current();if(p!=r&&(p?(d+=" hmd-html-begin",P.htmlBlock=t.f):d+=" hmd-html-end"),(i||g)&&(t.localMode&&i||(d=d.replace("inline-code","")),d+=" line-HyperMD-codeblock line-background-HyperMD-codeblock-bg",g!==i&&(g?i||(d+=" line-HyperMD-codeblock-begin line-background-HyperMD-codeblock-begin-bg"):d+=" line-HyperMD-codeblock-end line-background-HyperMD-codeblock-end-bg")),s){var b=t.hmdTable;if(o&&b)(1==b?Q:ee).test(e.string)?(t.hmdTableCol=0,t.hmdTableRow++):ne(t);if(o&&t.header&&(/^(?:---+|===+)\s*$/.test(e.string)&&t.prevLine&&t.prevLine.header?d+=" line-HyperMD-header-line line-HyperMD-header-line-"+t.header:d+=" line-HyperMD-header line-HyperMD-header-"+t.header),t.indentedCode&&(d+=" hmd-indented-code"),t.quote){if(e.eol()&&(d+=" line-HyperMD-quote line-HyperMD-quote-"+t.quote,/^ {0,3}\>/.test(e.string)||(d+=" line-HyperMD-quote-lazy")),o&&(n=v.match(/^\s+/)))return e.pos=n[0].length,(d+=" hmd-indent-in-quote").trim();/^>\s+$/.test(v)&&">"!=e.peek()&&(e.pos=e.start+1,v=">",t.hmdOverride=function(e,t){return e.match(re),t.hmdOverride=null,"hmd-indent-in-quote line-HyperMD-quote line-HyperMD-quote-"+t.quote})}var _=(t.listStack[t.listStack.length-1]||0)+3,k=o&&/^\s+$/.test(v)&&(!1!==t.list||e.indentation()<=_),y=t.list&&/formatting-list/.test(d);if(y||k&&(!1!==t.list||e.match(W,!1))){var w=t.listStack&&t.listStack.length||0;if(k){if(e.match(W,!1))!1===t.list&&w++;else{for(;0<w&&e.pos<t.listStack[w-1];)w--;if(!w)return d.trim()||null;d+=" line-HyperMD-list-line-nobullet line-HyperMD-list-line line-HyperMD-list-line-"+w}d+=" hmd-list-indent hmd-list-indent-"+w}else y&&(d+=" line-HyperMD-list-line line-HyperMD-list-line-"+w)}if(a!==t.linkText&&(a?(t.hmdLinkType in te&&(d+=" "+te[t.hmdLinkType]),4===t.hmdLinkType?t.hmdLinkType=5:t.hmdLinkType=0):(n=e.match(/^([^\]]+)\](\(| ?\[|\:)?/,!1))?n[2]?":"===n[2]?t.hmdLinkType=4:"["!==n[2]&&" ["!==n[2]||"]"!==e.string.charAt(e.pos+n[0].length)?t.hmdLinkType=3:t.hmdLinkType=6:"^"===n[1].charAt(0)?t.hmdLinkType=2:t.hmdLinkType=1:t.hmdLinkType=1),l!==t.linkHref&&(l?t.hmdLinkType&&(d+=" "+te[t.hmdLinkType],t.hmdLinkType=0):"["===v&&"]"!==e.peek()&&(t.hmdLinkType=7)),0!==t.hmdLinkType&&(t.hmdLinkType in te&&(d+=" "+te[t.hmdLinkType]),5===t.hmdLinkType&&(/^(?:\]\:)?\s*$/.test(v)||(X.test(v)||G.test(v)?d+=" hmd-footnote-url":d=d.replace("string url",""),t.hmdLinkType=0))),/formatting-escape/.test(d)&&1<v.length){var T=v.length-1,x=d.replace("formatting-escape","escape")+" hmd-escape-char";return t.hmdOverride=function(e,t){return e.pos+=T,t.hmdOverride=null,x.trim()},d+=" hmd-escape-backslash",e.pos-=T,d}if(!d.trim()&&F.table){var L=!1;if("|"===v.charAt(0)&&(e.pos=e.start+1,v="|",L=!0),L){if(!b){var M;if(Z.test(e.string)?b=1:J.test(e.string)&&(b=2),b){var C=e.lookAhead(1);if(2===b?J.test(C)?C=C.replace(/^\s*\|/,"").replace(/\|\s*$/,""):b=0:1===b&&(Z.test(C)||(b=0)),b){M=C.split("|");for(var O=0;O<M.length;O++){var S=M[O];if(/^\s*--+\s*:\s*$/.test(S))S="right";else if(/^\s*:\s*--+\s*$/.test(S))S="left";else if(/^\s*:\s*--+\s*:\s*$/.test(S))S="center";else{if(!/^\s*--+\s*$/.test(S)){b=0;break}S="default"}M[O]=S}}}b&&(t.hmdTable=b,t.hmdTableColumns=M,t.hmdTableID="T"+e.lineOracle.line,t.hmdTableRow=t.hmdTableCol=0)}if(b){var H=t.hmdTableColumns.length-1;if(2===b&&(0===t.hmdTableCol&&/^\s*\|$/.test(e.string.slice(0,e.pos))||e.match(/^\s*$/,!1)))d+=" hmd-table-sep hmd-table-sep-dummy";else if(t.hmdTableCol<H){var E=t.hmdTableRow,D=t.hmdTableCol++;0==D&&(d+=" line-HyperMD-table_"+t.hmdTableID+" line-HyperMD-table-"+b+" line-HyperMD-table-row line-HyperMD-table-row-"+E),d+=" hmd-table-sep hmd-table-sep-"+D}}}}if(b&&1===t.hmdTableRow&&/emoji/.test(d)&&(d=""),c&&"<"===v){var N=null;if(e.match(/^\![A-Z]+/)?N=">":e.match("?")?N="?>":e.match("![CDATA[")&&(N="]]>"),null!=N)return K(e,t,null,{endTag:N,style:(d+" comment hmd-cdata-html").trim()})}if(F.hashtag&&c)switch(t.hmdHashtag){case 0:if("#"===v&&!t.linkText&&!t.image&&(o||/^\s*$/.test(e.string.charAt(e.start-1)))){var A=e.string.slice(e.pos).replace(/\\./g,"");if(n=V.exec(A))for(/^\d+$/.test(n[0])?t.hmdHashtag=0:t.hmdHashtag=1,A=A.slice(n[0].length);;){if("#"===A[0]&&(1===A.length||!V.test(A[1]))){t.hmdHashtag=2;break}if(!(n=A.match(/^\s+/))||!(n=(A=A.slice(n[0].length)).match(V)))break;A=A.slice(n[0].length)}t.hmdHashtag&&(d+=" formatting formatting-hashtag hashtag-begin "+F.tokenTypeOverrides.hashtag)}break;case 1:var R=!1;if(!/formatting/.test(d)&&!/^\s*$/.test(v)){n=v.match(V);var j=v.length-(n?n[0].length:0);0<j&&(e.backUp(j),R=!0)}R||(R=e.eol()),R||(R=!V.test(e.peek())),R&&(d+=" hashtag-end",t.hmdHashtag=0);break;case 2:"#"===v&&(d=d.replace(/\sformatting-header(?:-\d+)?/g,""),d+=" formatting formatting-hashtag hashtag-end",t.hmdHashtag=0)}}return d.trim()||null},t},"hypermd"),B.defineMIME("text/x-hypermd","hypermd");var _=Object.freeze({});var k={byDrop:!1,byPaste:!1,fileHandler:null},y={byPaste:!0,byDrop:!0};l.hmdInsertFile=y,B.defineOption("hmdInsertFile",k,function(e,t){if(t&&"boolean"!=typeof t)"function"==typeof t&&(t={byDrop:!0,byPaste:!0,fileHandler:t});else{var n=!!t;t={byDrop:n,byPaste:n}}var r=M(e);for(var i in k)r[i]=i in t?t[i]:k[i]});var L=function(e){var o=this;this.cm=e,this.pasteHandle=function(e,t){o.doInsert(t.clipboardData||window.clipboardData)&&t.preventDefault()},this.dropHandle=function(t,n){var r=o,i=(t=o.cm,!1);t.operation(function(){var e=t.coordsChar({left:n.clientX,top:n.clientY},"window");t.setCursor(e),i=r.doInsert(n.dataTransfer)}),i&&n.preventDefault()},new s(function(){return o.cm.on("paste",o.pasteHandle)},function(){return o.cm.off("paste",o.pasteHandle)}).bind(this,"byPaste",!0),new s(function(){return o.cm.on("drop",o.dropHandle)},function(){return o.cm.off("drop",o.dropHandle)}).bind(this,"byDrop",!0)};L.prototype.doInsert=function(e){var a=this.cm;if(!e||!e.files||0===e.files.length)return!1;var r=e.files,i=this.fileHandler,l=!1;return"function"==typeof i&&(a.operation(function(){a.replaceSelection(".");var e=a.getCursor(),t={line:e.line,ch:e.ch-1},n=document.createElement("span"),o=a.markText(t,e,{replacedWith:n,clearOnEnter:!1,handleMouseEvents:!1});(l=i(r,{marker:o,cm:a,finish:function(r,i){return a.operation(function(){var e=o.find(),t=e.from,n=e.to;a.replaceRange(r,t,n),o.clear(),"number"==typeof i&&a.setCursor({line:t.line,ch:t.ch+i})})},setPlaceholder:function(e){0<n.childNodes.length&&n.removeChild(n.firstChild),n.appendChild(e),o.changed()},resize:function(){o.changed()}}))||o.clear()}),l)};var M=g("InsertFile",L,k),C=Object.freeze({ajaxUpload:function(e,t,n,r){var i=new XMLHttpRequest,o=new FormData;for(var a in t)o.append(a,t[a]);i.onreadystatechange=function(){if(4==this.readyState){var e=i.responseText;try{e=JSON.parse(i.responseText)}catch(e){}/^20\d/.test(i.status+"")?n(e,null):n(null,e)}},i.open(r||"POST",e,!0),i.send(o)},defaultOption:k,suggestedOption:y,InsertFile:L,getAddon:M});function O(e){var t=e=e.trim(),n="",r=e.match(/^(\S+)\s+("(?:[^"\\]+|\\.)+"|[^"\s].*)/);return r&&(t=r[1],'"'===(n=r[2]).charAt(0)&&(n=n.substr(1,n.length-2).replace(/\\"/g,'"'))),{url:t,title:n}}var S={hmdReadLink:function(e,t){return A(this).read(e,t)},hmdResolveURL:function(e,t){return A(this).resolve(e,t)},hmdSplitLink:O};for(var H in S)B.defineExtension(H,S[H]);var E={baseURI:""},D={baseURI:""};l.hmdReadLink=D,B.defineOption("hmdReadLink",E,function(e,t){t&&"string"!=typeof t||(t={baseURI:t});var n=A(e);for(var r in E)n[r]=r in t?t[r]:E[r]});var N=function(e){var t=this;this.cm=e,this.cache={},e.on("changes",u(function(){return t.rescan()},500)),this.rescan()};N.prototype.read=function(e,t){var n,r=this.cache[e.trim().toLowerCase()]||[];"number"!=typeof t&&(t=1e9);for(var i=0;i<r.length&&!((n=r[i]).line>t);i++);return n},N.prototype.rescan=function(){var e=this.cm,o=this.cache={};e.eachLine(function(e){var t=e.text,n=/^(?:>\s+)*>?\s{0,3}\[([^\]]+)\]:\s*(.+)$/.exec(t);if(n){var r=n[1].trim().toLowerCase(),i=n[2];o[r]||(o[r]=[]),o[r].push({line:e.lineNo(),content:i})}})},N.prototype.resolve=function(e,t){var n,r=/^(?:[\w-]+\:\/*|\/\/)[^\/]+/,i=/\/[^\/]+(?:\/+\.?)*$/;if(!e)return e;if(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e))return"mailto:"+e;var o="";if(!(t=t||this.baseURI)||r.test(e))return e;for((n=t.match(r))&&(o=n[0],t=t.slice(o.length));n=e.match(/^(\.{1,2})([\/\\]+)/);)e=e.slice(n[0].length),".."==n[1]&&(t=t.replace(i,""));return"/"===e.charAt(0)&&o?e=o+e:(/\/$/.test(t)||(t+="/"),e=o+t+e),e};var A=g("ReadLink",N,E),R=Object.freeze({splitLink:O,Extensions:S,defaultOption:E,suggestedOption:D,ReadLink:N,getAddon:A}),j="function"==typeof marked?marked:function(e){return"<pre>"+(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/  /g," &nbsp;"))+"</pre>"};function I(e,t){return t?j(t):null}var F={enabled:!1,xOffset:10,convertor:I},P={enabled:!0};l.hmdHover=P,B.defineOption("hmdHover",F,function(e,t){t&&"boolean"!=typeof t?"function"==typeof t&&(t={enabled:!0,convertor:t}):t={enabled:!!t};var n=ie(e);for(var r in F)n[r]=r in t?t[r]:F[r]});var q=function(e){var t=this;this.cm=e,new s(function(){n.addEventListener("mouseenter",a,!0)},function(){n.removeEventListener("mouseenter",a,!0),t.hideInfo()}).bind(this,"enabled",!0);var n=e.display.lineDiv;this.lineDiv=n;var r=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div");r.setAttribute("style","position:absolute;z-index:99"),r.setAttribute("class","HyperMD-hover"),r.setAttribute("cm-ignore-events","true"),i.setAttribute("class","HyperMD-hover-content"),r.appendChild(i),o.setAttribute("class","HyperMD-hover-indicator"),r.appendChild(o),this.tooltipDiv=r,this.tooltipContentDiv=i,this.tooltipIndicator=o;var a=this.mouseenter.bind(this)};q.prototype.mouseenter=function(e){var t,n=this.cm,r=e.target,i=r.className;if(!(r==this.tooltipDiv||r.compareDocumentPosition&&8==(8&r.compareDocumentPosition(this.tooltipDiv))))if("SPAN"===r.nodeName&&(t=i.match(/(?:^|\s)cm-(hmd-barelink2?|hmd-footref2)(?:\s|$)/))){var o=n.coordsChar({left:e.clientX,top:e.clientY},"window"),a=null,l=null,s=x(n,o,t[1]);s&&(a=(a=n.getRange(s.from,s.to)).slice(1,-1))&&(l=n.hmdReadLink(a,o.line)||null);var c=(this.convertor||I)(a,l&&l.content||null);c?this.showInfo(c,r):this.hideInfo()}else this.hideInfo()},q.prototype.showInfo=function(e,t){var n=t.getBoundingClientRect(),r=this.lineDiv.getBoundingClientRect(),i=this.tooltipDiv,o=this.xOffset;this.tooltipContentDiv.innerHTML=e,i.style.left=n.left-r.left-o+"px",this.lineDiv.appendChild(i);var a=i.getBoundingClientRect();a.right>r.right&&(o=a.right-r.right,i.style.left=n.left-r.left-o+"px"),i.style.top=n.top-r.top-a.height+"px",this.tooltipIndicator.style.marginLeft=o+"px"},q.prototype.hideInfo=function(){this.tooltipDiv.parentElement==this.lineDiv&&this.lineDiv.removeChild(this.tooltipDiv)};var K,ie=g("Hover",q,F),oe=Object.freeze({defaultConvertor:I,defaultOption:F,suggestedOption:P,Hover:q,getAddon:ie}),ae=function(e,t){var n=e.text,r=e.type,i=e.url,o=e.pos;if("url"===r||"link"===r){var a=n.match(/\[[^\[\]]+\](?:\[\])?$/);a&&e.altKey?("[]"===(n=a[0]).slice(-2)&&(n=n.slice(0,-2)),r="footref"):(e.ctrlKey||e.altKey)&&i&&window.open(i,"_blank")}if("todo"===r){var l=x(t,o,"formatting-task"),s=l.from,c=l.to,d=t.getRange(s,c);d="[ ]"===d?"[x]":"[ ]",t.replaceRange(d,s,c)}if("footref"===r&&(e.ctrlKey||e.altKey)){var h=n.slice(1,-1),u=t.hmdReadLink(h,o.line);u&&(le(t,u.line,o),t.setCursor({line:u.line,ch:0}))}},le=(K=null,function(e,t,n){var r,i,o=function(e){if(-1==e.options.gutters.indexOf("HyperMD-goback"))return null;var t=document.createElement("div");t.className="HyperMD-goback-button",t.addEventListener("click",function(){e.setCursor(K.find()),e.clearGutter("HyperMD-goback"),K.clear(),K=null});var n=e.display.gutters.children;return n=(n=n[n.length-1]).offsetLeft+n.offsetWidth,t.style.width=n+"px",t.style.marginLeft=-n+"px",t}(e);o&&(o.innerHTML=n.line+1+"",r=e,i=n,K&&(r.clearGutter("HyperMD-goback"),K.clear()),K=r.setBookmark(i),e.setGutterMarker(t,"HyperMD-goback",o))}),se={enabled:!1,handler:null},ce={enabled:!0};l.hmdClick=ce,B.defineOption("hmdClick",se,function(e,t){t&&"boolean"!=typeof t?"function"==typeof t&&(t={enabled:!0,handler:t}):t={enabled:!!t};var n=he(e);for(var r in se)n[r]=r in t?t[r]:se[r]});var de=function(e){var y=this;this.cm=e,this._mouseMove_keyDetect=function(e){var t=y.el,n=t.className,r=n,i="HyperMD-with-alt",o="HyperMD-with-ctrl";!e.altKey&&0<=n.indexOf(i)&&(r=n.replace(i,"")),!e.ctrlKey&&0<=n.indexOf(o)&&(r=n.replace(o,"")),e.altKey||e.ctrlKey||(y._KeyDetectorActive=!1,t.removeEventListener("mousemove",y._mouseMove_keyDetect,!1)),n!=r&&(t.className=r.trim())},this._keyDown=function(e){var t=e.keyCode||e.which,n="";17==t&&(n="HyperMD-with-ctrl"),18==t&&(n="HyperMD-with-alt");var r=y.el;n&&-1==r.className.indexOf(n)&&(r.className+=" "+n),y._KeyDetectorActive||(y._KeyDetectorActive=!0,y.el.addEventListener("mousemove",y._mouseMove_keyDetect,!1))},this._mouseUp=function(e){var t=y._cinfo;y.lineDiv.removeEventListener("mouseup",y._mouseUp,!1),5<Math.abs(e.clientX-t.clientX)||5<Math.abs(e.clientY-t.clientY)||"function"==typeof y.handler&&!1===y.handler(t,y.cm)||ae(t,y.cm)},this._mouseDown=function(e){var t=e.button,n=e.clientX,r=e.clientY,i=e.ctrlKey,o=e.altKey,a=e.shiftKey,l=y.cm;if("PRE"!==e.target.tagName){var s,c,d,h,u=l.coordsChar({left:n,top:r},"window"),m=l.getTokenAt(u),f=m.state,p=" "+m.type+" ",g=null;if(c=p.match(/\s(image|link|url)\s/)){g=c[1];var v,b=/\shmd-barelink\s/.test(p);if(f.linkText?(s=x(l,u,function(e){return e.state.linkText||/(?:\s|^)link(?:\s|$)/.test(e.type)}),g="link"):s=x(l,u,g),/^(?:image|link)$/.test(g)&&!b){var _=x(l,{line:u.line,ch:s.to.ch+1},"url");_&&(s.to=_.to)}if(")"===(d=l.getRange(s.from,s.to).trim()).slice(-1)&&-1!==(v=d.lastIndexOf("](")))h=O(d.slice(v+2,-1)).url;else if((c=d.match(/[^\\]\]\s?\[([^\]]+)\]$/))||(c=d.match(/^\[(.+)\]\s?\[\]$/))||(c=d.match(/^\[(.+)\](?:\:\s*)?$/))){b&&"^"===c[1].charAt(0)&&(g="footref");var k=l.hmdReadLink(c[1],u.line);h=k?O(k.content).url:null}else((c=d.match(/^\<(.+)\>$/))||(c=d.match(/^\((.+)\)$/))||(c=[null,d]))&&(h=c[1]);h=l.hmdResolveURL(h)}else p.match(/\sformatting-task\s/)?(g="todo",(s=x(l,u,"formatting-task")).to.ch=l.getLine(u.line).length,d=l.getRange(s.from,s.to),h=null):p.match(/\shashtag/)&&(s=x(l,u,g="hashtag"),d=l.getRange(s.from,s.to),h=null);null!==g&&(y._cinfo={type:g,text:d,url:h,pos:u,button:t,clientX:n,clientY:r,ctrlKey:i,altKey:o,shiftKey:a},y.lineDiv.addEventListener("mouseup",y._mouseUp,!1))}},this.lineDiv=e.display.lineDiv;var t=this.el=e.getWrapperElement();new s(function(){y.lineDiv.addEventListener("mousedown",y._mouseDown,!1),t.addEventListener("keydown",y._keyDown,!1)},function(){y.lineDiv.removeEventListener("mousedown",y._mouseDown,!1),t.removeEventListener("keydown",y._keyDown,!1)}).bind(this,"enabled",!0)},he=g("Click",de,se),ue=Object.freeze({defaultClickHandler:ae,defaultOption:se,suggestedOption:ce,Click:de,getAddon:he}),me={enabled:!1,convertor:null},fe={enabled:!0};l.hmdPaste=fe,B.defineOption("hmdPaste",me,function(e,t){t&&"boolean"!=typeof t?"function"==typeof t&&(t={enabled:!0,convertor:t}):t={enabled:!!t};var n=be(e);for(var r in me)n[r]=r in t?t[r]:me[r]});var pe,ge,ve=function(e){var o=this;this.cm=e,this.pasteHandler=function(e,t){var n=t.clipboardData||window.clipboardData,r=o.convertor;if(r&&n&&-1!=n.types.indexOf("text/html")){var i=r(n.getData("text/html"));i&&(e.operation(e.replaceSelection.bind(e,i)),t.preventDefault())}},new s(function(){e.on("paste",o.pasteHandler)},function(){e.off("paste",o.pasteHandler)}).bind(this,"enabled",!0)},be=g("Paste",ve,me),_e=Object.freeze({defaultOption:me,suggestedOption:fe,Paste:ve,getAddon:be});(ge=pe||(pe={})).OK="ok",ge.CURSOR_INSIDE="ci",ge.HAS_MARKERS="hm";var ke={};function ye(e,t,n,r){var i=ke;if(e in i&&!r)throw new Error("Folder "+e+" already registered");Le[e]=!1,Me[e]=!!n,i[e]=t}var we=function(e,t){var n=e.cm,r=/\bformatting-link-string\b/;if(/\bimage-marker\b/.test(t.type)&&"!"===t.string){var i=e.lineNo,o=e.findNext(r),a=e.findNext(r,o.i_token+1),l={line:i,ch:t.start},s={line:i,ch:a.token.end},c=e.requestRange(l,s);if(c===pe.OK){var d,h,u=n.getRange({line:i,ch:o.token.start+1},{line:i,ch:a.token.start});if("]"===a.token.string){var m=n.hmdReadLink(u,i);if(!m)return null;u=m.content}d=O(u).url,d=n.hmdResolveURL(d),h=n.getRange({line:i,ch:l.ch+2},{line:i,ch:o.token.start-1});var f=document.createElement("img"),p=n.markText(l,s,{collapsed:!0,replacedWith:f});return f.addEventListener("load",function(){f.classList.remove("hmd-image-loading"),p.changed()},!1),f.addEventListener("error",function(){f.classList.remove("hmd-image-loading"),f.classList.add("hmd-image-error"),p.changed()},!1),f.addEventListener("click",function(){return xe(n,p)},!1),f.className="hmd-image hmd-image-loading",f.src=d,f.title=h,p}}return null},Te=function(e,t){var n=e.cm,r=/\bformatting-link-string\b/;if("("===t.string&&r.test(t.type)&&(0===e.i_token||!/\bimage/.test(e.lineTokens[e.i_token-1].type))){var i=e.lineNo,o=e.findNext(function(e){return r.test(e.type)&&")"===e.string}),a={line:i,ch:t.start},l={line:i,ch:o.token.end},s=e.requestRange(a,l);if(s===pe.OK){var c=n.getRange(a,l),d=O(c.substr(1,c.length-2)),h=d.url,u=d.title,m=document.createElement("span");m.setAttribute("class","hmd-link-icon"),m.setAttribute("title",h+"\n"+u),m.setAttribute("data-url",h);var f=n.markText(a,l,{collapsed:!0,replacedWith:m});return m.addEventListener("click",function(){return xe(n,f)},!1),f}}return null};function xe(t,n,r){t.operation(function(){var e=n.find().from;e={line:e.line,ch:e.ch+~~r},t.setCursor(e),t.focus(),n.clear()})}var Le={},Me={};l.hmdFold=Me,c.hmdFold=!1,B.defineOption("hmdFold",Le,function(e,t){t&&"boolean"!=typeof t||(t=t?Me:Le),"customFolders"in t&&(console.error("[HyperMD][Fold] `customFolders` is removed. To use custom folders, `registerFolder` first."),delete t.customFolders);var n=Oe(e);for(var r in ke)n.setStatus(r,t[r])});var Ce=function(t){function e(e){var h=this;t.call(this,e),this.cm=e,this._enabled={},this.folded={},this.startFold=u(this.startFoldImmediately.bind(this),100),this._quickFoldHint=[],e.on("changes",function(e,t){for(var n=[],r=0,i=t;r<i.length;r+=1)for(var o=i[r],a=0,l=e.findMarks(o.from,o.to);a<l.length;a+=1){var s=l[a];s._hmd_fold_type&&n.push(s)}for(var c=0,d=n;c<d.length;c+=1){d[c].clear()}h.startFold()}),e.on("cursorActivity",function(e){h.startQuickFold()})}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setStatus=function(e,t){e in ke&&!this._enabled[e]!=!t&&(this._enabled[e]=!!t,t?this.startFold():this.clear(e))},e.prototype.requestRange=function(e,t){var n=this.cm,r=B.cmpPos,i=n.getCursor(),o=n.findMarks(e,t),a=pe.OK;return 0!==o.length?a=pe.HAS_MARKERS:0<=r(i,e)&&r(i,t)<=0&&(a=pe.CURSOR_INSIDE),a!==pe.OK&&this._quickFoldHint.push(e.line),a},e.prototype.startFoldImmediately=function(e,t){var v=this,n=this.cm;e=e||n.firstLine(),t=(t||n.lastLine())+1,this._quickFoldHint=[],this.setPos(e,0,!0),n.operation(function(){return n.eachLine(e,t,function(e){var t=e.lineNo();if(!(t<v.lineNo)){t>v.lineNo&&v.setPos(t,0);var n=new Array(e.text.length),r=e.markedSpans;if(r)for(var i=0;i<r.length;++i)for(var o=r[i],a=null==o.from?0:o.from,l=null==o.to?n.length:o.to,s=a;s<l;s++)n[s]=!0;for(var c=v.lineTokens;v.i_token<c.length;){for(var d,h=c[v.i_token],u=null,m=!0,f=h.start;f<h.end;f++)if(n[f]){m=!1;break}if(m)for(d in ke)if(v._enabled[d]&&(u=ke[d](v,h)))break;if(u){var p=u.find(),g=(p.from,p.to);if((v.folded[d]||(v.folded[d]=[])).push(u),u._hmd_fold_type=d,u.on("clear",function(e,t){var n,r=v.folded[d];r&&-1!==(n=r.indexOf(u))&&r.splice(n,1),v._quickFoldHint.push(e.line)}),g.line!==t)return void v.setPos(g.line,g.ch);v.setPos(g.ch)}else v.i_token++}}})})},e.prototype.startQuickFold=function(){var e=this._quickFoldHint;if(0!==e.length){for(var t=e[0],n=t,r=0,i=e;r<i.length;r+=1){var o=i[r];o<t&&(t=o),n<o&&(n=o)}this.startFold.stop(),this.startFoldImmediately(t,n)}},e.prototype.clear=function(e){this.startFold.stop();var t=this.folded[e];if(t&&t.length)for(var n;n=t.pop();)n.clear()},e.prototype.clearAll=function(){for(var e in this.startFold.stop(),this.folded)for(var t,n=this.folded[e];t=n.pop();)t.clear()},e}(z),Oe=g("Fold",Ce);ye("image",we,!0),ye("link",Te,!0);var Se=Object.freeze({get RequestRangeResult(){return pe},folderRegistry:ke,registerFolder:ye,ImageFolder:we,LinkFolder:Te,breakMark:xe,defaultOption:Le,suggestedOption:Me,Fold:Ce,getAddon:Oe}),He={};var Ee=function(e,t){return 0===t.start&&t.type&&-1!==t.type.indexOf("HyperMD-codeblock-begin")&&/[-\w]+\s*$/.test(t.string)?Pe(e.cm).fold(e,t):null};ye("code",Ee,!0);var De={},Ne={};l.hmdFoldCode=Ne,B.defineOption("hmdFoldCode",De,function(e,t){t&&"boolean"!=typeof t||(t=t?Ne:De);var n=Pe(e);for(var r in He)n.setStatus(r,t[r])});var Ae=function(e){this.cm=e,this._enabled={},this.folded={}};Ae.prototype.setStatus=function(e,t){e in He&&!this._enabled[e]!=!t&&(this._enabled[e]=!!t,t?Oe(this.cm).startFold():this.clear(e))},Ae.prototype.clear=function(e){var t=this.folded[e];if(t&&t.length)for(var n;n=t.pop();)n.marker.clear()},Ae.prototype.fold=function(e,t){var n=this;if(0!==t.start||!t.type||-1===t.type.indexOf("HyperMD-codeblock-begin"))return null;var r,i,o=/([-\w]+)\s*$/.exec(t.string),a=o&&o[1].toLowerCase();if(!a)return null;var l=this.cm,s=He,c=this._enabled;for(var d in s){var h=s[d];if(c[d]&&h.pattern(a)){i=d,r=h.renderer;break}}if(!i)return null;var u={line:e.lineNo,ch:0},m=null,f=l.lastLine(),p=e.lineNo+1;do{var g=l.getTokenAt({line:p,ch:1});if(g&&g.type&&-1!==g.type.indexOf("HyperMD-codeblock-end")){m={line:p,ch:g.end};break}}while(++p<f);if(!m)return null;if(e.requestRange(u,m)!==pe.OK)return null;var v=l.getRange({line:u.line+1,ch:0},{line:m.line,ch:0}),b={editor:l,lang:a,marker:null,lineWidget:null,el:null,break:Fe,changed:Fe},_=b.el=r(v,b);if(!_)return b.marker.clear(),null;var k=document.createElement("div");k.className=Re+i,k.style.minHeight="1em",k.appendChild(_);var y=b.lineWidget=l.addLineWidget(m.line,k,{above:!1,coverGutter:!1,noHScroll:!1,showIfHidden:!1}),w=document.createElement("span");w.className=je+i,w.textContent="<CODE>";var T=b.marker=l.markText(u,m,{replacedWith:w,clearOnEnter:!0});return k.addEventListener("mouseenter",function(){return w.className=Ie+i},!1),k.addEventListener("mouseleave",function(){return w.className=je+i},!1),b.changed=function(){y.changed()},b.break=function(){xe(l,T)},w.addEventListener("click",b.break,!1),T.on("clear",function(){var e,t=n.folded[i];t&&-1!==(e=t.indexOf(b))&&t.splice(e,1),"function"==typeof b.onRemove&&b.onRemove(b),y.clear()}),i in this.folded?this.folded[i].push(b):this.folded[i]=[b],T};var Re="hmd-fold-code-content hmd-fold-code-",je="hmd-fold-code-stub hmd-fold-code-",Ie="hmd-fold-code-stub highlight hmd-fold-code-",Fe=function(){},Pe=g("FoldCode",Ae,De),qe=Object.freeze({rendererRegistry:He,registerRenderer:function(t,e){if(t&&t.name&&t.renderer){var n=t.name,r=t.pattern,i=He;if(n in i&&!e)throw new Error("CodeRenderer "+n+" already exists");if("string"==typeof r){var o=r.toLowerCase();r=function(e){return e.toLowerCase()===o}}else r instanceof RegExp&&(r=function(e){return t.pattern.test(e)});var a={name:n,suggested:!!t.suggested,pattern:r,renderer:t.renderer};i[n]=a,De[n]=!1,Ne[n]=a.suggested}},CodeFolder:Ee,defaultOption:De,suggestedOption:Ne,FoldCode:Ae,getAddon:Pe}),$e=function(e,t){var n=/formatting-math-begin\b/;if(!n.test(t.type))return null;var r=e.cm,i=e.lineNo,o=/math-2\b/.test(t.type),a=o?2:1;if(2==a&&1==t.string.length){0;var l=e.lineTokens[e.i_token+1];if(!l||!n.test(l.type))return null}var s,c=e.findNext(/formatting-math-end\b/,o),d={line:i,ch:t.start},h=!1;if(c)s={line:c.lineNo,ch:c.token.start+a};else{if(!o)return null;var u=r.lastLine();s={line:u,ch:r.getLine(u).length},h=!0}var m={line:d.line,ch:d.ch+a},f={line:s.line,ch:s.ch-(h?0:a)},p=r.getRange(m,f).trim(),g=Xe(r),v=e.requestRange(d,s);if(v!==pe.OK)return v===pe.CURSOR_INSIDE&&(g.editingExpr=p),null;var b=ze(r,d,s,p,a,1<a&&0==d.ch&&(h||s.ch>=r.getLine(s.line).length));return g.editingExpr=null,b};function ze(e,t,n,r,i,o){var a=document.createElement("span");a.setAttribute("class","hmd-fold-math math-"+(o?2:1)),a.setAttribute("title",r);var l=document.createElement("span");l.setAttribute("class","hmd-fold-math-placeholder"),l.textContent=r,a.appendChild(l);var s=e.markText(t,n,{className:"hmd-fold-math",replacedWith:a,clearOnEnter:!0});a.addEventListener("click",function(){return xe(e,s,i)},!1);var c=Xe(e).createRenderer(a,o?"display":"");return c.onChanged=function(){l&&(a.removeChild(l),l=null),s.changed()},s.on("clear",function(){c.clear()}),s.mathRenderer=c,d(function(){return!!c.isReady()&&(c.startRender(r),!0)},5,function(){s.clear()}),s}ye("math",$e,!0);var Ke=function(e,t){var n=this;this.container=e;var r=document.createElement("img");r.setAttribute("class","hmd-math-dumb"),r.addEventListener("load",function(){n.onChanged&&n.onChanged(n.last_expr)},!1),this.img=r,e.appendChild(r)};Ke.prototype.startRender=function(e){this.last_expr=e,this.img.src="https://latex.codecogs.com/gif.latex?"+encodeURIComponent(e)},Ke.prototype.clear=function(){this.container.removeChild(this.img)},Ke.prototype.isReady=function(){return!0};var Be={renderer:Ke,onPreview:null,onPreviewEnd:null},Ue={};l.hmdFoldMath=Ue,B.defineOption("hmdFoldMath",Be,function(e,t){t?"function"==typeof t&&(t={renderer:t}):t={};var n=Xe(e);for(var r in Be)n[r]=r in t?t[r]:Be[r]});var We=function(e){var t=this;this.cm=e,new s(function(e){t.onPreview&&t.onPreview(e)},function(){t.onPreviewEnd&&t.onPreviewEnd()},null).bind(this,"editingExpr")};We.prototype.createRenderer=function(e,t){return new(this.renderer||Ke)(e,t)};var Xe=g("FoldMath",We,Be),Ye=Object.freeze({MathFolder:$e,insertMathMark:ze,DumbRenderer:Ke,defaultOption:Be,suggestedOption:Ue,FoldMath:We,getAddon:Xe}),Ge={},Ve=function(e){return e in Ge},Ze=function(e){var t=document.createElement("span");return t.textContent=Ge[e],t.title=e,t},Qe=function(e,t){if(!t.type||!/ formatting-emoji/.test(t.type))return null;var n=e.cm,r={line:e.lineNo,ch:t.start},i={line:e.lineNo,ch:t.end},o=t.string,a=nt(n);return a.isEmoji(o)?e.requestRange(r,i)!==pe.OK?null:a.foldEmoji(o,r,i):null};ye("emoji",Qe,!0);var Je={myEmoji:{},emojiRenderer:Ze,emojiChecker:Ve},et={};l.hmdFoldEmoji=et,B.defineOption("hmdFoldEmoji",Je,function(e,t){t||(t={});var n=nt(e);for(var r in Je)n[r]=r in t?t[r]:Je[r]});var tt=function(e){this.cm=e};tt.prototype.isEmoji=function(e){return e in this.myEmoji||this.emojiChecker(e)},tt.prototype.foldEmoji=function(e,t,n){var r=this.cm,i=e in this.myEmoji&&this.myEmoji[e](e)||this.emojiRenderer(e);if(!i||!i.tagName)return null;-1===i.className.indexOf("hmd-emoji")&&(i.className+=" hmd-emoji");var o=r.markText(t,n,{replacedWith:i,clearOnEnter:!0});return i.addEventListener("click",xe.bind(this,r,o,1),!1),"img"===i.tagName.toLowerCase()&&(i.addEventListener("load",function(){return o.changed()},!1),i.addEventListener("dragstart",function(e){return e.preventDefault()},!1)),o};var nt=g("FoldEmoji",tt,Je);!function(e){for(var t,n=["smile:ğŸ˜„;laughing:ğŸ˜†;blush:ğŸ˜Š;smiley:ğŸ˜ƒ;relaxed:â˜ºï¸;smirk:ğŸ˜;heart_eyes:ğŸ˜;kissing_heart:ğŸ˜˜;kissing_closed_eyes:ğŸ˜š;flushed:ğŸ˜³;relieved:ğŸ˜Œ;satisfied:ğŸ˜†;grin:ğŸ˜;wink:ğŸ˜‰;stuck_out_tongue_winking_eye:ğŸ˜œ;stuck_out_tongue_closed_eyes:ğŸ˜;grinning:ğŸ˜€;kissing:ğŸ˜—;kissing_smiling_eyes:ğŸ˜™;stuck_out_tongue:ğŸ˜›;sleeping:ğŸ˜´;worried:ğŸ˜Ÿ;frowning:ğŸ˜¦;anguished:ğŸ˜§;open_mouth:ğŸ˜®;grimacing:ğŸ˜¬;confused:ğŸ˜•;hushed:ğŸ˜¯;expressionless:ğŸ˜‘;unamused:ğŸ˜’;sweat_smile:ğŸ˜…;sweat:ğŸ˜“;disappointed_relieved:ğŸ˜¥;weary:ğŸ˜©;pensive:ğŸ˜”;disappointed:ğŸ˜;confounded:ğŸ˜–;fearful:ğŸ˜¨;cold_sweat:ğŸ˜°;persevere:ğŸ˜£;cry:ğŸ˜¢;sob:ğŸ˜­;joy:ğŸ˜‚;astonished:ğŸ˜²;scream:ğŸ˜±;tired_face:ğŸ˜«;angry:ğŸ˜ ;rage:ğŸ˜¡;triumph:ğŸ˜¤;sleepy:ğŸ˜ª;yum:ğŸ˜‹;mask:ğŸ˜·;sunglasses:ğŸ˜;dizzy_face:ğŸ˜µ;imp:ğŸ‘¿;smiling_imp:ğŸ˜ˆ;neutral_face:ğŸ˜;no_mouth:ğŸ˜¶;innocent:ğŸ˜‡;alien:ğŸ‘½;yellow_heart:ğŸ’›;blue_heart:ğŸ’™;purple_heart:ğŸ’œ;heart:â¤ï¸;green_heart:ğŸ’š;broken_heart:ğŸ’”;heartbeat:ğŸ’“;heartpulse:ğŸ’—;two_hearts:ğŸ’•;revolving_hearts:ğŸ’;cupid:ğŸ’˜;sparkling_heart:ğŸ’–;sparkles:âœ¨;star:â­ï¸;star2:ğŸŒŸ;dizzy:ğŸ’«;boom:ğŸ’¥;collision:ğŸ’¥;anger:ğŸ’¢;exclamation:â—ï¸;question:â“;grey_exclamation:â•;grey_question:â”;zzz:ğŸ’¤;dash:ğŸ’¨;sweat_drops:ğŸ’¦;notes:ğŸ¶;musical_note:ğŸµ;fire:ğŸ”¥;hankey:ğŸ’©;poop:ğŸ’©;shit:ğŸ’©;","+1:ğŸ‘;thumbsup:ğŸ‘;-1:ğŸ‘;thumbsdown:ğŸ‘;ok_hand:ğŸ‘Œ;punch:ğŸ‘Š;facepunch:ğŸ‘Š;fist:âœŠ;v:âœŒï¸;wave:ğŸ‘‹;hand:âœ‹;raised_hand:âœ‹;open_hands:ğŸ‘;point_up:â˜ï¸;point_down:ğŸ‘‡;point_left:ğŸ‘ˆ;point_right:ğŸ‘‰;raised_hands:ğŸ™Œ;pray:ğŸ™;point_up_2:ğŸ‘†;clap:ğŸ‘;muscle:ğŸ’ª;metal:ğŸ¤˜;fu:ğŸ–•;walking:ğŸš¶;runner:ğŸƒ;running:ğŸƒ;couple:ğŸ‘«;family:ğŸ‘ª;two_men_holding_hands:ğŸ‘¬;two_women_holding_hands:ğŸ‘­;dancer:ğŸ’ƒ;dancers:ğŸ‘¯;ok_woman:ğŸ™†;no_good:ğŸ™…;information_desk_person:ğŸ’;raising_hand:ğŸ™‹;bride_with_veil:ğŸ‘°;person_with_pouting_face:ğŸ™;person_frowning:ğŸ™;bow:ğŸ™‡;couplekiss::couplekiss:;couple_with_heart:ğŸ’‘;massage:ğŸ’†;haircut:ğŸ’‡;nail_care:ğŸ’…;boy:ğŸ‘¦;girl:ğŸ‘§;woman:ğŸ‘©;man:ğŸ‘¨;baby:ğŸ‘¶;older_woman:ğŸ‘µ;older_man:ğŸ‘´;person_with_blond_hair:ğŸ‘±;man_with_gua_pi_mao:ğŸ‘²;man_with_turban:ğŸ‘³;construction_worker:ğŸ‘·;cop:ğŸ‘®;angel:ğŸ‘¼;princess:ğŸ‘¸;smiley_cat:ğŸ˜º;smile_cat:ğŸ˜¸;heart_eyes_cat:ğŸ˜»;kissing_cat:ğŸ˜½;smirk_cat:ğŸ˜¼;scream_cat:ğŸ™€;crying_cat_face:ğŸ˜¿;joy_cat:ğŸ˜¹;pouting_cat:ğŸ˜¾;japanese_ogre:ğŸ‘¹;japanese_goblin:ğŸ‘º;see_no_evil:ğŸ™ˆ;hear_no_evil:ğŸ™‰;speak_no_evil:ğŸ™Š;guardsman:ğŸ’‚;skull:ğŸ’€;feet:ğŸ¾;lips:ğŸ‘„;kiss:ğŸ’‹;droplet:ğŸ’§;ear:ğŸ‘‚;eyes:ğŸ‘€;nose:ğŸ‘ƒ;tongue:ğŸ‘…;love_letter:ğŸ’Œ;bust_in_silhouette:ğŸ‘¤;busts_in_silhouette:ğŸ‘¥;speech_balloon:ğŸ’¬;","thought_balloon:ğŸ’­;sunny:â˜€ï¸;umbrella:â˜”ï¸;cloud:â˜ï¸;snowflake:â„ï¸;snowman:â›„ï¸;zap:âš¡ï¸;cyclone:ğŸŒ€;foggy:ğŸŒ;ocean:ğŸŒŠ;cat:ğŸ±;dog:ğŸ¶;mouse:ğŸ­;hamster:ğŸ¹;rabbit:ğŸ°;wolf:ğŸº;frog:ğŸ¸;tiger:ğŸ¯;koala:ğŸ¨;bear:ğŸ»;pig:ğŸ·;pig_nose:ğŸ½;cow:ğŸ®;boar:ğŸ—;monkey_face:ğŸµ;monkey:ğŸ’;horse:ğŸ´;racehorse:ğŸ;camel:ğŸ«;sheep:ğŸ‘;elephant:ğŸ˜;panda_face:ğŸ¼;snake:ğŸ;bird:ğŸ¦;baby_chick:ğŸ¤;hatched_chick:ğŸ¥;hatching_chick:ğŸ£;chicken:ğŸ”;penguin:ğŸ§;turtle:ğŸ¢;bug:ğŸ›;honeybee:ğŸ;ant:ğŸœ;beetle:ğŸ;snail:ğŸŒ;octopus:ğŸ™;tropical_fish:ğŸ ;fish:ğŸŸ;whale:ğŸ³;whale2:ğŸ‹;dolphin:ğŸ¬;cow2:ğŸ„;ram:ğŸ;rat:ğŸ€;water_buffalo:ğŸƒ;tiger2:ğŸ…;rabbit2:ğŸ‡;dragon:ğŸ‰;goat:ğŸ;rooster:ğŸ“;dog2:ğŸ•;pig2:ğŸ–;mouse2:ğŸ;ox:ğŸ‚;dragon_face:ğŸ²;blowfish:ğŸ¡;crocodile:ğŸŠ;dromedary_camel:ğŸª;leopard:ğŸ†;cat2:ğŸˆ;poodle:ğŸ©;paw_prints:ğŸ¾;bouquet:ğŸ’;cherry_blossom:ğŸŒ¸;tulip:ğŸŒ·;four_leaf_clover:ğŸ€;rose:ğŸŒ¹;sunflower:ğŸŒ»;hibiscus:ğŸŒº;maple_leaf:ğŸ;leaves:ğŸƒ;fallen_leaf:ğŸ‚;herb:ğŸŒ¿;mushroom:ğŸ„;cactus:ğŸŒµ;palm_tree:ğŸŒ´;evergreen_tree:ğŸŒ²;deciduous_tree:ğŸŒ³;chestnut:ğŸŒ°;seedling:ğŸŒ±;blossom:ğŸŒ¼;ear_of_rice:ğŸŒ¾;shell:ğŸš;globe_with_meridians:ğŸŒ;sun_with_face:ğŸŒ;full_moon_with_face:ğŸŒ;new_moon_with_face:ğŸŒš;new_moon:ğŸŒ‘;waxing_crescent_moon:ğŸŒ’;first_quarter_moon:ğŸŒ“;waxing_gibbous_moon:ğŸŒ”;full_moon:ğŸŒ•;waning_gibbous_moon:ğŸŒ–;last_quarter_moon:ğŸŒ—;waning_crescent_moon:ğŸŒ˜;last_quarter_moon_with_face:ğŸŒœ;","first_quarter_moon_with_face:ğŸŒ›;moon:ğŸŒ”;earth_africa:ğŸŒ;earth_americas:ğŸŒ;earth_asia:ğŸŒ;volcano:ğŸŒ‹;milky_way:ğŸŒŒ;partly_sunny:â›…ï¸;bamboo:ğŸ;gift_heart:ğŸ’;dolls:ğŸ;school_satchel:ğŸ’;mortar_board:ğŸ“;flags:ğŸ;fireworks:ğŸ†;sparkler:ğŸ‡;wind_chime:ğŸ;rice_scene:ğŸ‘;jack_o_lantern:ğŸƒ;ghost:ğŸ‘»;santa:ğŸ…;christmas_tree:ğŸ„;gift:ğŸ;bell:ğŸ””;no_bell:ğŸ”•;tanabata_tree:ğŸ‹;tada:ğŸ‰;confetti_ball:ğŸŠ;balloon:ğŸˆ;crystal_ball:ğŸ”®;cd:ğŸ’¿;dvd:ğŸ“€;floppy_disk:ğŸ’¾;camera:ğŸ“·;video_camera:ğŸ“¹;movie_camera:ğŸ¥;computer:ğŸ’»;tv:ğŸ“º;iphone:ğŸ“±;phone:â˜ï¸;telephone:â˜ï¸;telephone_receiver:ğŸ“;pager:ğŸ“Ÿ;fax:ğŸ“ ;minidisc:ğŸ’½;vhs:ğŸ“¼;sound:ğŸ”‰;speaker:ğŸ”ˆ;mute:ğŸ”‡;loudspeaker:ğŸ“¢;mega:ğŸ“£;hourglass:âŒ›ï¸;hourglass_flowing_sand:â³;alarm_clock:â°;watch:âŒšï¸;radio:ğŸ“»;satellite:ğŸ“¡;loop:â¿;mag:ğŸ”;mag_right:ğŸ”;unlock:ğŸ”“;lock:ğŸ”’;lock_with_ink_pen:ğŸ”;closed_lock_with_key:ğŸ”;key:ğŸ”‘;bulb:ğŸ’¡;flashlight:ğŸ”¦;high_brightness:ğŸ”†;low_brightness:ğŸ”…;electric_plug:ğŸ”Œ;battery:ğŸ”‹;calling:ğŸ“²;email:âœ‰ï¸;mailbox:ğŸ“«;postbox:ğŸ“®;bath:ğŸ›€;bathtub:ğŸ›;shower:ğŸš¿;toilet:ğŸš½;wrench:ğŸ”§;nut_and_bolt:ğŸ”©;hammer:ğŸ”¨;seat:ğŸ’º;moneybag:ğŸ’°;yen:ğŸ’´;dollar:ğŸ’µ;pound:ğŸ’·;euro:ğŸ’¶;","credit_card:ğŸ’³;money_with_wings:ğŸ’¸;e-mail:ğŸ“§;inbox_tray:ğŸ“¥;outbox_tray:ğŸ“¤;envelope:âœ‰ï¸;incoming_envelope:ğŸ“¨;postal_horn:ğŸ“¯;mailbox_closed:ğŸ“ª;mailbox_with_mail:ğŸ“¬;mailbox_with_no_mail:ğŸ“­;door:ğŸšª;smoking:ğŸš¬;bomb:ğŸ’£;gun:ğŸ”«;hocho:ğŸ”ª;pill:ğŸ’Š;syringe:ğŸ’‰;page_facing_up:ğŸ“„;page_with_curl:ğŸ“ƒ;bookmark_tabs:ğŸ“‘;bar_chart:ğŸ“Š;chart_with_upwards_trend:ğŸ“ˆ;chart_with_downwards_trend:ğŸ“‰;scroll:ğŸ“œ;clipboard:ğŸ“‹;calendar:ğŸ“†;date:ğŸ“…;card_index:ğŸ“‡;file_folder:ğŸ“;open_file_folder:ğŸ“‚;scissors:âœ‚ï¸;pushpin:ğŸ“Œ;paperclip:ğŸ“;black_nib:âœ’ï¸;pencil2:âœï¸;straight_ruler:ğŸ“;triangular_ruler:ğŸ“;closed_book:ğŸ“•;green_book:ğŸ“—;blue_book:ğŸ“˜;orange_book:ğŸ“™;notebook:ğŸ““;notebook_with_decorative_cover:ğŸ“”;ledger:ğŸ“’;books:ğŸ“š;bookmark:ğŸ”–;name_badge:ğŸ“›;microscope:ğŸ”¬;telescope:ğŸ”­;newspaper:ğŸ“°;football:ğŸˆ;basketball:ğŸ€;soccer:âš½ï¸;baseball:âš¾ï¸;tennis:ğŸ¾;8ball:ğŸ±;","rugby_football:ğŸ‰;bowling:ğŸ³;golf:â›³ï¸;mountain_bicyclist:ğŸšµ;bicyclist:ğŸš´;horse_racing:ğŸ‡;snowboarder:ğŸ‚;swimmer:ğŸŠ;surfer:ğŸ„;ski:ğŸ¿;spades:â™ ï¸;hearts:â™¥ï¸;clubs:â™£ï¸;diamonds:â™¦ï¸;gem:ğŸ’;ring:ğŸ’;trophy:ğŸ†;musical_score:ğŸ¼;musical_keyboard:ğŸ¹;violin:ğŸ»;space_invader:ğŸ‘¾;video_game:ğŸ®;black_joker:ğŸƒ;flower_playing_cards:ğŸ´;game_die:ğŸ²;dart:ğŸ¯;mahjong:ğŸ€„ï¸;clapper:ğŸ¬;memo:ğŸ“;pencil:ğŸ“;book:ğŸ“–;art:ğŸ¨;microphone:ğŸ¤;headphones:ğŸ§;trumpet:ğŸº;saxophone:ğŸ·;guitar:ğŸ¸;shoe:ğŸ‘;sandal:ğŸ‘¡;high_heel:ğŸ‘ ;lipstick:ğŸ’„;boot:ğŸ‘¢;shirt:ğŸ‘•;tshirt:ğŸ‘•;necktie:ğŸ‘”;womans_clothes:ğŸ‘š;dress:ğŸ‘—;running_shirt_with_sash:ğŸ½;jeans:ğŸ‘–;kimono:ğŸ‘˜;bikini:ğŸ‘™;ribbon:ğŸ€;tophat:ğŸ©;crown:ğŸ‘‘;womans_hat:ğŸ‘’;mans_shoe:ğŸ‘;closed_umbrella:ğŸŒ‚;briefcase:ğŸ’¼;handbag:ğŸ‘œ;pouch:ğŸ‘;purse:ğŸ‘›;eyeglasses:ğŸ‘“;fishing_pole_and_fish:ğŸ£;coffee:â˜•ï¸;tea:ğŸµ;sake:ğŸ¶;baby_bottle:ğŸ¼;beer:ğŸº;beers:ğŸ»;cocktail:ğŸ¸;tropical_drink:ğŸ¹;wine_glass:ğŸ·;fork_and_knife:ğŸ´;pizza:ğŸ•;hamburger:ğŸ”;fries:ğŸŸ;poultry_leg:ğŸ—;meat_on_bone:ğŸ–;spaghetti:ğŸ;curry:ğŸ›;fried_shrimp:ğŸ¤;bento:ğŸ±;sushi:ğŸ£;fish_cake:ğŸ¥;rice_ball:ğŸ™;rice_cracker:ğŸ˜;rice:ğŸš;","ramen:ğŸœ;stew:ğŸ²;oden:ğŸ¢;dango:ğŸ¡;egg:ğŸ¥š;bread:ğŸ;doughnut:ğŸ©;custard:ğŸ®;icecream:ğŸ¦;ice_cream:ğŸ¨;shaved_ice:ğŸ§;birthday:ğŸ‚;cake:ğŸ°;cookie:ğŸª;chocolate_bar:ğŸ«;candy:ğŸ¬;lollipop:ğŸ­;honey_pot:ğŸ¯;apple:ğŸ;green_apple:ğŸ;tangerine:ğŸŠ;lemon:ğŸ‹;cherries:ğŸ’;grapes:ğŸ‡;watermelon:ğŸ‰;strawberry:ğŸ“;peach:ğŸ‘;melon:ğŸˆ;banana:ğŸŒ;pear:ğŸ;pineapple:ğŸ;sweet_potato:ğŸ ;eggplant:ğŸ†;tomato:ğŸ…;corn:ğŸŒ½;house:ğŸ ;house_with_garden:ğŸ¡;school:ğŸ«;office:ğŸ¢;post_office:ğŸ£;hospital:ğŸ¥;bank:ğŸ¦;convenience_store:ğŸª;love_hotel:ğŸ©;hotel:ğŸ¨;wedding:ğŸ’’;church:â›ªï¸;department_store:ğŸ¬;european_post_office:ğŸ¤;city_sunrise:ğŸŒ‡;city_sunset:ğŸŒ†;japanese_castle:ğŸ¯;european_castle:ğŸ°;tent:â›ºï¸;factory:ğŸ­;tokyo_tower:ğŸ—¼;japan:ğŸ—¾;mount_fuji:ğŸ—»;sunrise_over_mountains:ğŸŒ„;sunrise:ğŸŒ…;stars:ğŸŒ ;statue_of_liberty:ğŸ—½;bridge_at_night:ğŸŒ‰;carousel_horse:ğŸ ;rainbow:ğŸŒˆ;ferris_wheel:ğŸ¡;fountain:â›²ï¸;roller_coaster:ğŸ¢;ship:ğŸš¢;speedboat:ğŸš¤;boat:â›µï¸;sailboat:â›µï¸;rowboat:ğŸš£;anchor:âš“ï¸;rocket:ğŸš€;airplane:âœˆï¸;helicopter:ğŸš;steam_locomotive:ğŸš‚;tram:ğŸšŠ;mountain_railway:ğŸš;bike:ğŸš²;aerial_tramway:ğŸš¡;suspension_railway:ğŸšŸ;","mountain_cableway:ğŸš ;tractor:ğŸšœ;blue_car:ğŸš™;oncoming_automobile:ğŸš˜;car:ğŸš—;red_car:ğŸš—;taxi:ğŸš•;oncoming_taxi:ğŸš–;articulated_lorry:ğŸš›;bus:ğŸšŒ;oncoming_bus:ğŸš;rotating_light:ğŸš¨;police_car:ğŸš“;oncoming_police_car:ğŸš”;fire_engine:ğŸš’;ambulance:ğŸš‘;minibus:ğŸš;truck:ğŸšš;train:ğŸš‹;station:ğŸš‰;train2:ğŸš†;bullettrain_front:ğŸš…;bullettrain_side:ğŸš„;light_rail:ğŸšˆ;monorail:ğŸš;railway_car:ğŸšƒ;trolleybus:ğŸš;ticket:ğŸ«;fuelpump:â›½ï¸;vertical_traffic_light:ğŸš¦;traffic_light:ğŸš¥;warning:âš ï¸;construction:ğŸš§;beginner:ğŸ”°;atm:ğŸ§;slot_machine:ğŸ°;busstop:ğŸš;barber:ğŸ’ˆ;hotsprings:â™¨ï¸;checkered_flag:ğŸ;crossed_flags:ğŸŒ;izakaya_lantern:ğŸ®;moyai:ğŸ—¿;circus_tent:ğŸª;performing_arts:ğŸ­;round_pushpin:ğŸ“;triangular_flag_on_post:ğŸš©;jp:ğŸ‡¯ğŸ‡µ;kr:ğŸ‡°ğŸ‡·;cn:ğŸ‡¨ğŸ‡³;us:ğŸ‡ºğŸ‡¸;fr:ğŸ‡«ğŸ‡·;es:ğŸ‡ªğŸ‡¸;it:ğŸ‡®ğŸ‡¹;ru:ğŸ‡·ğŸ‡º;gb:ğŸ‡¬ğŸ‡§;uk:ğŸ‡¬ğŸ‡§;de:ğŸ‡©ğŸ‡ª;one:1ï¸âƒ£;two:2ï¸âƒ£;three:3ï¸âƒ£;four:4ï¸âƒ£;five:5ï¸âƒ£;six:6ï¸âƒ£;seven:7ï¸âƒ£;eight:8ï¸âƒ£;nine:9ï¸âƒ£;keycap_ten:ğŸ”Ÿ;","1234:ğŸ”¢;zero:0ï¸âƒ£;hash:#ï¸âƒ£;symbols:ğŸ”£;arrow_backward:â—€ï¸;arrow_down:â¬‡ï¸;arrow_forward:â–¶ï¸;arrow_left:â¬…ï¸;capital_abcd:ğŸ” ;abcd:ğŸ”¡;abc:ğŸ”¤;arrow_lower_left:â†™ï¸;arrow_lower_right:â†˜ï¸;arrow_right:â¡ï¸;arrow_up:â¬†ï¸;arrow_upper_left:â†–ï¸;arrow_upper_right:â†—ï¸;arrow_double_down:â¬;arrow_double_up:â«;arrow_down_small:ğŸ”½;arrow_heading_down:â¤µï¸;arrow_heading_up:â¤´ï¸;leftwards_arrow_with_hook:â†©ï¸;arrow_right_hook:â†ªï¸;left_right_arrow:â†”ï¸;arrow_up_down:â†•ï¸;arrow_up_small:ğŸ”¼;arrows_clockwise:ğŸ”ƒ;arrows_counterclockwise:ğŸ”„;rewind:âª;fast_forward:â©;information_source:â„¹ï¸;ok:ğŸ†—;twisted_rightwards_arrows:ğŸ”€;repeat:ğŸ”;repeat_one:ğŸ”‚;new:ğŸ†•;top:ğŸ”;up:ğŸ†™;cool:ğŸ†’;free:ğŸ†“;ng:ğŸ†–;cinema:ğŸ¦;koko:ğŸˆ;signal_strength:ğŸ“¶;u5272:ğŸˆ¹;u5408:ğŸˆ´;u55b6:ğŸˆº;u6307:ğŸˆ¯ï¸;u6708:ğŸˆ·ï¸;u6709:ğŸˆ¶;u6e80:ğŸˆµ;u7121:ğŸˆšï¸;u7533:ğŸˆ¸;u7a7a:ğŸˆ³;u7981:ğŸˆ²;sa:ğŸˆ‚ï¸;restroom:ğŸš»;mens:ğŸš¹;womens:ğŸšº;baby_symbol:ğŸš¼;no_smoking:ğŸš­;","parking:ğŸ…¿ï¸;wheelchair:â™¿ï¸;metro:ğŸš‡;baggage_claim:ğŸ›„;accept:ğŸ‰‘;wc:ğŸš¾;potable_water:ğŸš°;put_litter_in_its_place:ğŸš®;secret:ãŠ™ï¸;congratulations:ãŠ—ï¸;m:â“‚ï¸;passport_control:ğŸ›‚;left_luggage:ğŸ›…;customs:ğŸ›ƒ;ideograph_advantage:ğŸ‰;cl:ğŸ†‘;sos:ğŸ†˜;id:ğŸ†”;no_entry_sign:ğŸš«;underage:ğŸ”;no_mobile_phones:ğŸ“µ;do_not_litter:ğŸš¯;non-potable_water:ğŸš±;no_bicycles:ğŸš³;no_pedestrians:ğŸš·;children_crossing:ğŸš¸;no_entry:â›”ï¸;eight_spoked_asterisk:âœ³ï¸;eight_pointed_black_star:âœ´ï¸;heart_decoration:ğŸ’Ÿ;vs:ğŸ†š;vibration_mode:ğŸ“³;mobile_phone_off:ğŸ“´;chart:ğŸ’¹;currency_exchange:ğŸ’±;aries:â™ˆï¸;taurus:â™‰ï¸;gemini:â™Šï¸;cancer:â™‹ï¸;leo:â™Œï¸;virgo:â™ï¸;libra:â™ï¸;scorpius:â™ï¸;","sagittarius:â™ï¸;capricorn:â™‘ï¸;aquarius:â™’ï¸;pisces:â™“ï¸;ophiuchus:â›;six_pointed_star:ğŸ”¯;negative_squared_cross_mark:â;a:ğŸ…°ï¸;b:ğŸ…±ï¸;ab:ğŸ†;o2:ğŸ…¾ï¸;diamond_shape_with_a_dot_inside:ğŸ’ ;recycle:â™»ï¸;end:ğŸ”š;on:ğŸ”›;soon:ğŸ”œ;clock1:ğŸ•;clock130:ğŸ•œ;clock10:ğŸ•™;clock1030:ğŸ•¥;clock11:ğŸ•š;clock1130:ğŸ•¦;clock12:ğŸ•›;clock1230:ğŸ•§;clock2:ğŸ•‘;clock230:ğŸ•;clock3:ğŸ•’;clock330:ğŸ•;clock4:ğŸ•“;clock430:ğŸ•Ÿ;clock5:ğŸ•”;clock530:ğŸ• ;clock6:ğŸ••;clock630:ğŸ•¡;clock7:ğŸ•–;clock730:ğŸ•¢;clock8:ğŸ•—;clock830:ğŸ•£;clock9:ğŸ•˜;clock930:ğŸ•¤;heavy_dollar_sign:ğŸ’²;copyright:Â©ï¸;registered:Â®ï¸;tm:â„¢ï¸;x:âŒ;heavy_exclamation_mark:â—ï¸;bangbang:â€¼ï¸;interrobang:â‰ï¸;o:â­•ï¸;heavy_multiplication_x:âœ–ï¸;","heavy_plus_sign:â•;heavy_minus_sign:â–;heavy_division_sign:â—;white_flower:ğŸ’®;100:ğŸ’¯;heavy_check_mark:âœ”ï¸;ballot_box_with_check:â˜‘ï¸;radio_button:ğŸ”˜;link:ğŸ”—;curly_loop:â°;wavy_dash:ã€°ï¸;part_alternation_mark:ã€½ï¸;trident:ğŸ”±;black_square::black_square:;white_square::white_square:;white_check_mark:âœ…;black_square_button:ğŸ”²;white_square_button:ğŸ”³;black_circle:âš«ï¸;white_circle:âšªï¸;red_circle:ğŸ”´;large_blue_circle:ğŸ”µ;large_blue_diamond:ğŸ”·;large_orange_diamond:ğŸ”¶;small_blue_diamond:ğŸ”¹;small_orange_diamond:ğŸ”¸;small_red_triangle:ğŸ”º;small_red_triangle_down:ğŸ”»"],r=/([-\w]+:)([^;]+);/g,i=0;i<n.length;i++)for(r.lastIndex=0;t=r.exec(n[i]);)e[":"+t[1]]=t[2]}(Ge);var rt=Object.freeze({defaultDict:Ge,defaultChecker:Ve,defaultRenderer:Ze,EmojiFolder:Qe,defaultOption:Je,suggestedOption:et,FoldEmoji:tt,getAddon:nt}),it=function(e){return!/^<(?:br)/i.test(e)&&(!/<(?:script|style|link|meta)/i.test(e)&&(!/\son\w+\s*=/i.test(e)&&!/src\s*=\s*["']?javascript:/i.test(e)))},ot=function(e,t,a){var n=/^<(\w+)\s*/.exec(e);if(!n)return null;for(var r,i=n[1],o=document.createElement(i),l=/([\w\:\-]+)(?:\s*=\s*((['"]).*?\3|\S+))?\s*/g,s=l.lastIndex=n[0].length;(r=l.exec(e))&&!(r.index>s);){var c=r[1],d=r[2];d&&/^['"]/.test(d)&&(d=d.slice(1,-1)),o.setAttribute(c,d),s=l.lastIndex}if("innerHTML"in o){var h=e.indexOf(">",s)+1,u=e.length;(r=new RegExp("</"+i+"\\s*>\\s*$","i").exec(e))&&(u=r.index);var m=e.slice(h,u);m&&(o.innerHTML=m),f([o],function(e){var t=e.tagName.toLowerCase();"a"===t&&(e.getAttribute("target")||e.setAttribute("target","_blank"));var n={a:["href"],img:["src"],iframe:["src"]}[t];if(n)for(var r=0;r<n.length;r++){var i=n[r],o=e.getAttribute(i);o&&e.setAttribute(i,a.hmdResolveURL(o))}})}return o},at="hmd-fold-html-stub",lt=function(e,t){if(!t.type||!/ hmd-html-begin/.test(t.type))return null;var n=e.findNext(/ hmd-html-\w+/,!0);if(!n||!/ hmd-html-end/.test(n.token.type)||/ hmd-html-unclosed/.test(n.token.type))return null;var r=e.cm,i={line:e.lineNo,ch:t.start},o={line:n.lineNo,ch:n.token.end},a=0!=i.ch||o.ch<r.getLine(o.line).length,l=ht(r),s=r.getRange(i,o);return l.checker(s,i,r)?e.requestRange(i,o)!==pe.OK?null:l.renderAndInsert(s,i,o,a):null};ye("html",lt,!1);var st={checker:it,renderer:ot,stubText:"<HTML>",isolatedTagName:/^(?:div|pre|form|table|iframe|ul|ol|input|textarea|p|summary|a)$/i},ct={};l.hmdFoldHTML=ct,B.defineOption("hmdFoldHTML",st,function(e,t){t?"function"==typeof t?t={checker:t}:"object"!=typeof t&&(console.warn("[HyperMD][FoldHTML] incorrect option value type"),t={}):t={};var n=ht(e);for(var r in st)n[r]=r in t?t[r]:st[r];!n.isolatedTagName||n.isolatedTagName instanceof RegExp||(console.error("[HyperMD][FoldHTML] option isolatedTagName only accepts RegExp"),n.isolatedTagName=st.isolatedTagName)});var dt=function(e){this.cm=e};dt.prototype.renderAndInsert=function(e,t,n,r){var i,o,a=this.cm,l=this.makeStub(),s=this.renderer(e,t,a),c=function(){return xe(a,o)};if(!s)return null;if(l.addEventListener("click",c,!1),s.tagName.match(this.isolatedTagName||/^$/)||s.addEventListener("click",c,!1),r){var d=document.createElement("span");d.setAttribute("class","hmd-fold-html"),d.setAttribute("style","display: inline-block"),d.appendChild(l),d.appendChild(s),i=d,(h=p(s,function(e,t){var n=getComputedStyle(s),r=function(e){return n.getPropertyValue(e)},i=e<10||t<10||!/^relative|static$/i.test(r("position"))||!/^none$/i.test(r("float"));l.className=i?at:"hmd-fold-html-stub omittable",o.changed()})).check(),setTimeout(function(){o.on("clear",function(){h.stop()})},0)}else{i=l;var h,u=a.addLineWidget(n.line,s,{above:!1,coverGutter:!1,noHScroll:!1,showIfHidden:!1}),m=function(){return l.className="hmd-fold-html-stub highlight"},f=function(){return l.className=at};s.addEventListener("mouseenter",m,!1),s.addEventListener("mouseleave",f,!1),(h=p(s,function(){return u.changed()})).check(),setTimeout(function(){o.on("clear",function(){h.stop(),u.clear(),s.removeEventListener("mouseenter",m,!1),s.removeEventListener("mouseleave",f,!1)})},0)}return o=a.markText(t,n,{clearOnEnter:!0,replacedWith:i})},dt.prototype.makeStub=function(){var e=document.createElement("span");return e.setAttribute("class",at),e.textContent=this.stubText||"<HTML>",e};var ht=g("FoldHTML",dt,st),ut=Object.freeze({defaultChecker:it,defaultRenderer:ot,HTMLFolder:lt,defaultOption:st,suggestedOption:ct,FoldHTML:dt,getAddon:ht}),mt={enabled:!1},ft={enabled:!0};l.hmdTableAlign=ft,c.hmdTableAlign=!1,B.defineOption("hmdTableAlign",mt,function(e,t){var n=!!t;n&&"boolean"!=typeof t||(t={enabled:n});var r=gt(e);for(var i in mt)r[i]=i in t?t[i]:mt[i]});var pt=function(e){var p=this;this.cm=e,this.styleEl=document.createElement("style"),this.updateStyle=u(function(){if(p.enabled){var e=p.cm,t=p.measure(),n=p.makeCSS(t);n!==p._lastCSS&&(p.styleEl.textContent=p._lastCSS=n,setTimeout(function(){return m(e)},50))}},100),this._procLine=function(e,t,n){if(n.querySelector(".cm-hmd-table-sep")){for(var r=n.firstElementChild,i=Array.prototype.slice.call(r.childNodes,0),o=e.getStateAfter(t.lineNo()),a=o.hmdTableColumns,l=o.hmdTableID,s=2===o.hmdTable?-1:0,c=p.makeColumn(s,a[s]||"dummy",l),d=c.firstElementChild,h=0,u=i;h<u.length;h+=1){var m=u[h],f=m.nodeType===Node.ELEMENT_NODE&&m.className||"";/cm-hmd-table-sep/.test(f)?(s++,c.appendChild(d),r.appendChild(c),r.appendChild(m),d=(c=p.makeColumn(s,a[s]||"dummy",l)).firstElementChild):d.appendChild(m)}c.appendChild(d),r.appendChild(c)}},new s(function(){e.on("renderLine",p._procLine),e.on("update",p.updateStyle),e.refresh(),document.head.appendChild(p.styleEl)},function(){e.off("renderLine",p._procLine),e.off("update",p.updateStyle),document.head.removeChild(p.styleEl)}).bind(this,"enabled",!0)};pt.prototype.makeColumn=function(e,t,n){var r=document.createElement("span");r.className="hmd-table-column hmd-table-column-"+e+" hmd-table-column-"+t,r.setAttribute("data-column",""+e),r.setAttribute("data-table-id",n);var i=document.createElement("span");return i.className="hmd-table-column-content",i.setAttribute("data-column",""+e),r.appendChild(i),r},pt.prototype.measure=function(){for(var e=this.cm.display.lineDiv.querySelectorAll(".hmd-table-column-content"),t={},n=0;n<e.length;n++){var r=e[n],i=r.parentElement,o=i.getAttribute("data-table-id"),a=~~i.getAttribute("data-column"),l=r.offsetWidth+1;o in t||(t[o]=[]);for(var s=t[o];s.length<=a;)s.push(0);s[a]<l&&(s[a]=l)}return t},pt.prototype.makeCSS=function(e){var t=[];for(var n in e)for(var r=e[n],i="pre.HyperMD-table-row.HyperMD-table_"+n+" .hmd-table-column-",o=0;o<r.length;o++){var a=r[o];t.push(""+i+o+" { min-width: "+a+"px }")}return t.join("\n")};var gt=g("TableAlign",pt,mt),vt=Object.freeze({defaultOption:mt,suggestedOption:ft,TableAlign:pt,getAddon:gt}),bt={source:null},_t={source:"function"==typeof requirejs?"~codemirror/":"https://cdn.jsdelivr.net/npm/codemirror/"};l.hmdModeLoader=_t,B.defineOption("hmdModeLoader",bt,function(e,t){t&&"boolean"!=typeof t?"string"!=typeof t&&"function"!=typeof t||(t={source:t}):t={source:t&&_t.source||null};var n=yt(e);for(var r in bt)n[r]=r in t?t[r]:bt[r]});var kt=function(e){var l=this;this.cm=e,this._loadingModes={},this.rlHandler=function(e,t){var n=t.lineNo(),r=(t.text||"").match(/^```\s*(\S+)/);if(r){var i=r[1],o=B.findModeByName(i),a=o&&o.mode;!a||a in B.modes||l.startLoadMode(a,n)}},(new s).bind(this,"source").ON(function(){e.on("renderLine",l.rlHandler)}).OFF(function(){e.off("renderLine",l.rlHandler)})};kt.prototype.touchLine=function(e){var t=this.cm.getLineHandle(e),n=t.text.length;this.cm.replaceRange(t.text.charAt(n-1),{line:e,ch:n-1},{line:e,ch:n})},kt.prototype.startLoadMode=function(e,t){var n=this._loadingModes,r=this;if(0<=t&&e in n)n[e].push(t);else{0<=t&&(n[e]=[t]);var i=function(){console.log("[HyperMD] mode-loader loaded "+e);var t=n[e];r.cm.operation(function(){for(var e=0;e<t.length;e++)r.touchLine(t[e])}),delete n[e]},o=function(){console.warn("[HyperMD] mode-loader failed to load mode "+e+" from ",a),-1!==t&&(console.log("[HyperMD] mode-loader will retry loading "+e),setTimeout(function(){r.startLoadMode(e,0<=t?-3:t+1)},1e3))};if("function"!=typeof this.source){var a=this.source+"mode/"+e+"/"+e+".js";if("function"==typeof requirejs&&"~"===a.charAt(0))requirejs([a.slice(1,-3)],i);else{var l=document.createElement("script");l.onload=i,l.onerror=o,l.src=a,document.head.appendChild(l)}}else this.source(e,i,o)}};var yt=g("ModeLoader",kt,bt),wt=Object.freeze({defaultOption:bt,suggestedOption:_t,ModeLoader:kt,getAddon:yt}),Tt={enabled:!1,line:!0,tokenTypes:"em|strong|strikethrough|code|link|task".split("|")},xt={enabled:!0};l.hmdHideToken=xt,c.hmdHideToken=!1,B.defineOption("hmdHideToken",Tt,function(e,t){t&&"boolean"!=typeof t?"string"==typeof t?t={enabled:!0,tokenTypes:t.split("|")}:t instanceof Array&&(t={enabled:!0,tokenTypes:t}):t={enabled:!!t};var n=Ot(e);for(var r in Tt)n[r]=r in t?t[r]:Tt[r]});var Lt="hmd-hidden-token",Mt="hmd-inactive-line",Ct=function(e){var r=this;this.cm=e,this.shownTokensStart={},this.renderLineHandler=function(e,t,n){r.procLine(t,n)},this.cursorActivityHandler=function(e){r.update()},this.update=u(function(){return r.updateImmediately()},100),new s(function(){e.on("cursorActivity",r.cursorActivityHandler),e.on("renderLine",r.renderLineHandler),e.on("update",r.update),r.update(),e.refresh()},function(){e.off("cursorActivity",r.cursorActivityHandler),e.off("renderLine",r.renderLineHandler),e.off("update",r.update),r.update.stop(),e.refresh()}).bind(this,"enabled",!0)};Ct.prototype.calcShownTokenStart=function(){var e=this.cm,t=e.getCursor(),n=this.tokenTypes,r=new RegExp("\\sformatting-("+n.join("|")+")\\s"),i={},o=e.getLineTokens(t.line),a=-1,l=[],s=null,c=[];for(var d=0;d<o.length;d++){var h=o[d];-1===a&&(h.end>t.ch||d===o.length-1)&&(a=d);var u=h.type&&h.type.match(r);if(u){var m=u[1];if(m!==s){var f=l[l.length-1];if(f&&f[1]===m){if(l.pop(),-1!==a||h.end===t.ch){c.push(f[0],h);break}}else if(l.push([h,m]),-1!==a){c.push(h);var p=new RegExp("\\sformatting-"+m+"\\s");for(d+=1;d<o.length;d++){var g=o[d];if(g.type&&p.test(g.type)){c.push(g);break}}break}0,s=m}}else{if(-1!==a){if(0<l.length){var v=l.pop(),b=v[0],_=v[1],k=new RegExp("\\sformatting-"+_+"\\s");for(c.push(b),d+=1;d<o.length;d++){var y=o[d];if(y.type&&k.test(y.type)){c.push(y);break}}}break}s=null}if(-1!==a&&0===l.length)break}for(var w=i[t.line]=[],T=0,x=c;T<x.length;T+=1){var L=x[T];w.push(L.start)}if(d>=o.length-1)for(var M=0,C=l;M<C.length;M+=1){var O=C[M][0].start;-1===w.indexOf(O)&&w.push(O)}return i},Ct.prototype.procLine=function(e,t){if(!e)return-1;var n=this.cm,r=e.lineNo(),i=w(n,r);if(!i||i.hidden||!i.measure)return-1;for(var o=T(i,e,r).map,a=o.length/3,l=(r in this.shownTokensStart?this.shownTokensStart[r].slice().sort(function(e,t){return e-t}):null),s=-1,c=0,d=0;c<a;c++,d+=3){var h=o[d],u=(o[d+1],o[d+2]),m=u.parentElement;if(u.nodeType===Node.TEXT_NODE&&m&&/^span$/i.test(m.nodeName))for(var f=m.className,p=0,g=this.tokenTypes;p<g.length;p+=1){var v=g[p];if(("link"!==v||!/(?:^|\s)(?:cm-hmd-footref|cm-hmd-footnote|cm-hmd-barelink)(?:\s|$)/.test(f))&&-1!==f.indexOf("cm-formatting-"+v+" ")){var b=!0;if(l&&0<l.length){for(;l[0]<h;)l.shift();b=l[0]!==h}b?-1===f.indexOf(Lt)&&(m.className+=" "+Lt,-1===s&&(s=h)):-1!==f.indexOf(Lt)&&(m.className=f.replace(Lt,""),-1===s&&(s=h));break}}}if(this.line&&(t=t||i.text)){var _=t.className,k=-1===_.indexOf(Mt),y=null!==l;k!=y&&(t.className=y?_.replace(Mt,""):_+" "+Mt,s=0)}return-1!==s&&i.measure.cache&&(i.measure.cache={}),s},Ct.prototype.updateImmediately=function(){var i=this,o=this.cm,a=o.getCursor(),e=this.shownTokensStart,t=this.shownTokensStart=this.enabled?this.calcShownTokenStart():{},l=!1,s=[];for(var n in e)s.push(~~n);for(var r in t)s.push(~~r);s.sort(function(e,t){return e-t}),o.operation(function(){for(var e=-1,t=0,n=s;t<n.length;t+=1){var r=n[t];if(r!==e)e=r,-1!==i.procLine(o.getLineHandle(r))&&a.line===r&&(l=!0)}l&&(m(o,!0),o.hmd.TableAlign&&o.hmd.TableAlign.enabled&&o.hmd.TableAlign.updateStyle())})};var Ot=g("HideToken",Ct,Tt),St=Object.freeze({defaultOption:Tt,suggestedOption:xt,HideToken:Ct,getAddon:Ot}),Ht={enabled:!1},Et={enabled:!0};l.hmdCursorDebounce=Et,B.defineOption("hmdCursorDebounce",Ht,function(e,t){t&&"boolean"!=typeof t||(t={enabled:!!t});var n=Nt(e);for(var r in Ht)n[r]=r in t?t[r]:Ht[r]});var Dt=function(e){var r=this;this.cm=e,this.mouseDownHandler=function(e,t){r.lastX=t.clientX,r.lastY=t.clientY;var n=r.mouseMoveSuppress;document.addEventListener("mousemove",n,!0),r.lastTimeout&&clearTimeout(r.lastTimeout),r.lastTimeout=setTimeout(function(){document.removeEventListener("mousemove",n,!0),r.lastTimeout=null},100)},this.mouseMoveSuppress=function(e){Math.abs(e.clientX-r.lastX)<=5&&Math.abs(e.clientY-r.lastY)<=5&&e.stopPropagation()},new s(function(){e.on("mousedown",r.mouseDownHandler)},function(){e.off("mousedown",r.mouseDownHandler)}).bind(this,"enabled",!0)},Nt=g("CursorDebounce",Dt,Ht),At=Object.freeze({defaultOption:Ht,suggestedOption:Et,CursorDebounce:Dt,getAddon:Nt}),Rt=/^(\s*)(>[> ]*|[*+-] \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,jt=/^(\s*)(>[> ]*|[*+-] \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,It=/[*+-]\s/,Ft=/^(\s*)([*+-]\s|(\d+)([.)]))(\s*)/,Pt=function(e){return/hmd-table-sep/.test(e.type)&&!/hmd-table-sep-dummy/.test(e.type)};function qt(e){if(e.getOption("disableInput"))return B.Pass;for(var t=[],n=0,r=e.listSelections();n<r.length;n+=1){var i=r[n],o=i.head,a=i.empty(),l=e.getStateAfter(o.line),s=e.getLine(o.line),c=!1;if(!c){var d=!1!==l.list,h=l.quote,u=Rt.exec(s),m=/^\s*$/.test(s.slice(0,o.ch));if(a&&(d||h)&&u&&!m)if(c=!0,jt.test(s))/>\s*$/.test(s)||e.replaceRange("",{line:o.line,ch:0},{line:o.line,ch:o.ch+1}),t.push("\n");else{var f=u[1],p=u[5],g=!(It.test(u[2])||0<=u[2].indexOf(">")),v=g?parseInt(u[3],10)+1+u[4]:u[2].replace("x"," ");t.push("\n"+f+v+p),g&&Wt(e,o)}}if(!c){var b=a?l.hmdTable:0;if(0!=b){if(!/^[\s\|]+$/.test(s)||o.line!==e.lastLine()&&e.getStateAfter(o.line+1).hmdTable===b){var _=$("  |  ",l.hmdTableColumns.length-1),k="\n";2===b&&(k+="| ",_+=" |"),0==l.hmdTableRow?e.setCursor({line:o.line+1,ch:e.getLine(o.line+1).length}):e.setCursor({line:o.line,ch:s.length}),e.replaceSelection(k),e.replaceSelection(_,"start")}else e.setCursor({line:o.line,ch:0}),e.replaceRange("\n",{line:o.line,ch:0},{line:o.line,ch:s.length});return void(c=!0)}if(a&&o.ch>=s.length&&!l.code&&!l.hmdInnerMode&&/^\|.+\|.+\|$/.test(s)){for(var y=e.getLineTokens(o.line),w="|",T="|",x=1;x<y.length;x++){var L=y[x];"|"!==L.string||L.type&&L.type.trim().length||(w+=" ------- |",T+="   |")}return e.setCursor({line:o.line,ch:s.length}),e.replaceSelection("\n"+w+"\n| "),e.replaceSelection(T.slice(1)+"\n","start"),void(c=!0)}}if(c||a&&"$$"==s.slice(o.ch-2,o.ch)&&/math-end/.test(e.getTokenTypeAt(o))&&(t.push("\n"),c=!0),!c)return void e.execCommand("newlineAndIndent")}e.replaceSelections(t)}function $t(e){if(e.getOption("disableInput"))return B.Pass;for(var t=e.listSelections(),n=a("\n",t.length),r=0;r<t.length;r++){var i=t[r].head,o=e.getStateAfter(i.line);!1!==o.list&&(n[r]+=$(" ",o.listStack.slice(-1)[0]))}e.replaceSelections(n)}function zt(e,t,n){if(n&&!(n<0)){var r=/^ */.exec(e.getLine(t))[0].length;r<n&&(n=r),0<n&&e.replaceRange("",{line:t,ch:0},{line:t,ch:n})}}function Kt(e){for(var t,n=e.listSelections(),r=new z(e),i=0;i<n.length;i++){var o=n[i],a=o.head,l=o.anchor;!o.empty()&&0<B.cmpPos(a,l)?(l=(t=[a,l])[0],a=t[1]):l===a&&(l=o.anchor={ch:a.ch,line:a.line});var s=e.getStateAfter(a.line);if(s.hmdTable){r.setPos(a.line,a.ch);var c=2===s.hmdTable,d=a.line,h=e.getLine(d),u=0,m=0,f=r.findPrev(Pt);if(f){u=(p=r.findPrev(Pt,f.i_token-1))?p.token.end:0,m=f.token.start,0==u&&c&&(u+=h.match(/^\s*\|/)[0].length)}else{if(0==s.hmdTableRow)return;var p;2==s.hmdTableRow&&d--,d--,h=e.getLine(d),r.setPos(d,h.length),u=(p=r.findPrev(Pt)).token.end,m=h.length,c&&(m-=h.match(/\|\s*$/)[0].length)}return" "===h.charAt(u)&&(u+=1),0<u&&" |"===h.substr(u-1,2)&&u--," "===h.charAt(m-1)&&(m-=1),void e.setSelection({line:d,ch:u},{line:d,ch:m})}if(0<s.listStack.length){for(var g=a.line;!Ft.test(e.getLine(g));){if(g--,!(0<e.getStateAfter(g).listStack.length)){g++;break}}for(var v=e.lastLine(),b=void 0;g<=l.line&&(b=Ft.exec(e.getLine(g)));g++){var _=e.getStateAfter(g).listStack,k=_.length,y=0;for(zt(e,g,y=1==k?b[1].length:_[k-1]-(_[k-2]||0));++g<=v;){if(e.getStateAfter(g).listStack.length!==k){g=1/0;break}if(Ft.test(e.getLine(g))){g--;break}zt(e,g,y)}}return}}e.execCommand("indentLess")}function Bt(e){var t,n=e.listSelections(),r=[],i=[],o=[],a={},l=new z(e),s=!1,c=!1,d=!1,h=!0;function u(e){(r[p]=e)&&(c=!0)}function m(e){(i[p]=e)&&(d=!0)}function f(e){(o[p]=e)&&(h=!0)}for(var p=0;p<n.length;p++){r[p]=i[p]=o[p]="";var g=n[p],v=g.head,b=g.anchor,_=g.empty();!_&&0<B.cmpPos(v,b)?(b=(t=[v,b])[0],v=t[1]):b===v&&(b=g.anchor={ch:v.ch,line:v.line});var k=e.getStateAfter(v.line),y=e.getLine(v.line);if(k.hmdTable){s=!0;var w=2===k.hmdTable,T=k.hmdTableColumns;l.setPos(v.line,v.ch);var x=l.findNext(Pt,l.i_token);if(x){var L=l.findNext(/hmd-table-sep/,x.i_token+1);v.ch=x.token.end,b.ch=L?L.token.start:y.length,b.ch>v.ch&&" "===y.charAt(v.ch)&&v.ch++,b.ch>v.ch&&" "===y.charAt(b.ch-1)&&b.ch--,f(b.ch>v.ch?e.getRange(v,b):"")}else{var M=0===k.hmdTableRow?2:1;if(v.line+M>e.lastLine()||e.getStateAfter(v.line+M).hmdTable!=k.hmdTable){v.ch=b.ch=y.length;var C=$("  |  ",T.length-1);0===k.hmdTableRow&&(b.line=v.line+=1,b.ch=v.ch=e.getLine(v.line).length),w?(u("\n| "),m(C+" |")):(u("\n"),m(C.trimRight())),f("")}else{b.line=v.line+=M,l.setPos(v.line,0);var O=l.line.text,S=w&&l.findNext(/hmd-table-sep-dummy/,0),H=l.findNext(/hmd-table-sep/,S?S.i_token+1:1);v.ch=S?S.token.end:0,b.ch=H?H.token.start:O.length,b.ch>v.ch&&" "===O.charAt(v.ch)&&v.ch++,b.ch>v.ch&&" "===O.charAt(b.ch-1)&&b.ch--,f(b.ch>v.ch?e.getRange(v,b):"")}}}else if(0<k.listStack.length){for(var E=v.line,D=void 0;!(D=Ft.exec(e.getLine(E)));){if(E--,!(0<e.getStateAfter(E).listStack.length)){E++;break}}for(var N=e.firstLine(),A=e.lastLine();E<=b.line&&(D=Ft.exec(e.getLine(E)));E++){var R=e.getStateAfter(E).listStack,j=e.getStateAfter(E-1).listStack,I=R.length,F="";for(N<E&&I<=j.length&&(F=I==j.length?$(" ",j[I-1]-D[1].length):$(" ",j[I]-D[0].length)),a[E]=F;++E<=A;){if(e.getStateAfter(E).listStack.length!==I){E=1/0;break}if(Ft.test(e.getLine(E))){E--;break}a[E]=F}}if(!_){h=!1;break}}else if(_)u("    ");else{f(e.getRange(v,b));for(var P=v.line;P<=b.line;P++)P in a||(a[P]="    ")}}for(var q in a)a[q]&&e.replaceRange(a[q],{line:~~q,ch:0});s&&e.setSelections(n),c&&e.replaceSelections(r),d&&e.replaceSelections(i,"start"),h&&e.replaceSelections(o,"around")}function Ut(T,x,L){return function(e){var t;if(e.getOption("disableInput"))return B.Pass;for(var n=new z(e),r=e.listSelections(),i=new Array(r.length),o=0;o<r.length;o++){var a=r[o],l=a.head,s=a.anchor,c=e.getStateAfter(l.line),d=a.empty();0<B.cmpPos(l,s)&&(s=(t=[l,s])[0],l=t[1]);var h=i[o]=d?"":e.getRange(l,s);if(d||T(e.getTokenAt(l).state)){var u=l.line;n.setPos(u,l.ch,!0);var m=n.lineTokens[n.i_token];m&&m.state;m&&!/^\s*$/.test(m.string)||(m=n.lineTokens[--n.i_token]);var f=n.expandRange(function(e){return e&&(T(e.state)||x(e))}),p=f.from,g=f.to;if(g.i_token===p.i_token){var v=L();if(m&&!/^\s*$/.test(m.string)){var b={line:u,ch:m.start},_={line:u,ch:m.end};return m=p.token,e.replaceRange(v+m.string+v,b,_),_.ch+=v.length,void e.setCursor(_)}i[o]=v}else x(g.token)&&e.replaceRange("",{line:u,ch:g.token.start},{line:u,ch:g.token.end}),p.i_token!==g.i_token&&x(p.token)&&e.replaceRange("",{line:u,ch:p.token.start},{line:u,ch:p.token.end})}else{var k=e.getTokenAt(l),y=k?k.state:c,w=L(y);i[o]=w+h+w}}e.replaceSelections(i)}}function Wt(e,t){var n=Rt,r=t.line,i=0,o=0,a=n.exec(e.getLine(r)),l=a[1];do{var s=r+(i+=1),c=e.getLine(s),d=n.exec(c);if(d){var h=d[1],u=parseInt(a[3],10)+i-o,m=parseInt(d[3],10),f=m;if(l!==h||isNaN(m)){if(l.length>h.length)return;if(l.length<h.length&&1===i)return;o+=1}else u===m&&(f=m+1),m<u&&(f=u+1),e.replaceRange(c.replace(n,h+f+d[4]+d[5]),{line:s,ch:0},{line:s,ch:c.length})}}while(d)}Object.assign(B.commands,{hmdNewlineAndContinue:qt,hmdNewline:$t,hmdShiftTab:Kt,hmdTab:Bt});B.keyMap.default;var Xt={"Shift-Tab":"hmdShiftTab",Tab:"hmdTab",Enter:"hmdNewlineAndContinue","Shift-Enter":"hmdNewline","Ctrl-B":Ut(function(e){return e.strong},function(e){return/ formatting-strong /.test(e.type)},function(e){return $(e&&e.strong||"*",2)}),"Ctrl-I":Ut(function(e){return e.em},function(e){return/ formatting-em /.test(e.type)},function(e){return e&&e.em||"*"}),"Ctrl-D":Ut(function(e){return e.strikethrough},function(e){return/ formatting-strikethrough /.test(e.type)},function(e){return"~~"}),fallthrough:"default"};Xt=B.normalizeKeyMap(Xt),B.keyMap.hypermd=Xt,l.keyMap="hypermd";var Yt=Object.freeze({newlineAndContinue:qt,newline:$t,shiftTab:Kt,tab:Bt,wrapTexts:function(e,t,n){var r;if(e.getOption("disableInput"))return B.Pass;var i=e.listSelections(),o=new Array(i.length),a=new Array(i.length),l=!1,s=!1,c=!1;n||(n=t);for(var d=t.length,h=n.length,u=0;u<i.length;u++){o[u]=a[u]="";var m=i[u],f=m.head,p=m.anchor,g=e.getLine(f.line);if(m.empty())f.ch>=d&&g.substr(f.ch-d,d)===t?(c=!0,f.ch-=d):(s=!0,a[u]=t);else{l=!0,0<B.cmpPos(f,p)&&(p=(r=[f,p])[0],f=r[1]);var v=e.getRange(f,p);f.ch>=d&&f.line===p.line&&g.substr(f.ch-d,d)===t&&g.substr(p.ch,h)===n&&(c=!0,p.ch+=h,f.ch-=d,v=t+v+n),v.slice(0,d)===t&&v.slice(-h)===n?o[u]=v.slice(d,-h):o[u]=t+v+n}}c&&e.setSelections(i),s&&e.replaceSelections(a),l&&e.replaceSelections(o,"around")},createStyleToggler:Ut,get keyMap(){return Xt}});e.Mode=_,e.InsertFile=C,e.ReadLink=R,e.Hover=oe,e.Click=ue,e.Paste=_e,e.Fold=Se,e.FoldCode=qe,e.FoldMath=Ye,e.FoldEmoji=rt,e.FoldHTML=ut,e.TableAlign=vt,e.ModeLoader=wt,e.HideToken=St,e.CursorDebounce=At,e.KeyMap=Yt,e.Addon=v,e.FlipFlop=s,e.tryToRun=d,e.debounce=u,e.addClass=t,e.rmClass=n,e.contains=r,e.repeat=a,e.repeatStr=$,e.visitElements=f,e.watchSize=p,e.suggestedEditorConfig=l,e.normalVisualConfig=c,e.fromTextArea=function(e,t){var n=Object.assign({},l,t),r=B.fromTextArea(e,n);return r[o]=!0,r},e.switchToNormal=function(e,t){if(e[o]){"string"==typeof t&&(t={theme:t});var n=Object.assign({},c,t);for(var r in n)e.setOption(r,n[r])}},e.switchToHyperMD=function(e,t){"string"==typeof t&&(t={theme:t});var n={};if(o in e){for(var r in c)n[r]=l[r];Object.assign(n,t)}else Object.assign(n,l,t),e[o]=!0;for(var i in n)e.setOption(i,n[i])},e.cm_internal=h,e.TokenSeeker=z,e.getEveryCharToken=function(e){var t=new Array(e.text.length),n=e.styles,r=0;if(n)for(var i=1;i<n.length;i+=2)for(var o=n[i],a=n[i+1];r<o;)t[r++]=a;else for(var l=(e.parent.cm||e.parent.parent.cm||e.parent.parent.parent.cm).getLineTokens(e.lineNo()),s=0;s<l.length;s++)for(var c=l[s].end,d=l[s].type;r<c;)t[r++]=d;return t},e.expandRange=x,e.updateCursorDisplay=m,Object.defineProperty(e,"__esModule",{value:!0})});
